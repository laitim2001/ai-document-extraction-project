---
stepsCompleted: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
inputDocuments:
  - "docs/00-discovery/product-brief-ai-document-extraction-project-2025-12-14.md"
documentCounts:
  briefs: 1
  research: 0
  brainstorming: 0
  projectDocs: 0
workflowType: 'prd'
lastStep: 11
completedAt: '2025-12-14'
project_name: 'ai-document-extraction-project'
user_name: 'chris'
date: '2025-12-14'
---

# Product Requirements Document - ai-document-extraction-project

**Author:** chris
**Date:** 2025-12-14

---

## Executive Summary

### 產品願景

本項目旨在建立一套 AI 驅動的文件內容提取與自動分類系統，專門解決 SCM 部門處理 Freight Invoice 的效率問題。系統將處理來自 100+ 種不同格式的發票（45+ 個 Forwarder），自動提取內容並映射到**約 90 個**統一 Header，目標達成 90-95% 的自動化率和準確率。

APAC 地區每年約有 450,000-500,000 張文件需要處理。透過本系統的實施，預計可節省 35,000-40,000 人時/年，大幅提升工作效率並降低人工成本。更重要的是，結構化的數據將為供應商分析、費用優化和異常檢測提供堅實基礎。

### 產品定位

| 項目 | 說明 |
|------|------|
| **產品類型** | 內部工具（非對外產品） |
| **先行地區** | 香港公司 |
| **擴展計劃** | 驗證成功後推廣至 APAC 其他城市 |

### 核心問題

SCM 部門目前面臨嚴峻的文件處理挑戰：
- **效率瓶頸**：每張發票人工處理需 5 分鐘，年處理量 50 萬張 = 約 41,667 人時/年
- **準確性風險**：人工處理 100+ 種格式容易產生錯誤和遺漏
- **擴展困難**：業務增長需按比例增加人力，難以規模化
- **數據價值損失**：數據品質不穩定，管理層無法獲取準確洞察
- **人才浪費**：專業人員困在低價值的數據錄入工作中

### 目標用戶

- **Primary**：Amy（數據處理專員）- 每天處理 150-200 張發票，希望從重複性工作中解放
- **Primary**：David（SCM 經理）- 需要完整費用明細做分析和供應商議價
- **Secondary**：Super User、IT 支援、財務部門、審計人員

### 數據流向

```
┌─────────────┐     ┌─────────────┐     ┌─────────────────────────┐
│  文件來源   │ ──▶ │  AI 處理    │ ──▶ │      輸出目標           │
│ SharePoint  │     │  提取+分類  │     │ • Excel 導出            │
│ Outlook     │     │  人工審核   │     │ • PostgreSQL            │
│ 手動上傳    │     │             │     │ • Snowflake (DW)        │
└─────────────┘     └─────────────┘     └─────────────────────────┘
```

### What Makes This Special

| 差異化優勢 | 說明 |
|-----------|------|
| **智能三層映射架構** | 從傳統 9,000 條規則降至約 800 條，大幅降低維護成本 |
| **持續學習閉環** | 每次人工修正自動學習，3 次確認即升級為正式規則 |
| **信心度評分機制** | 智能平衡自動化效率與人工品控（>90% 自動、70-90% 快速確認、<70% 完整審核） |
| **n8n 工作流引擎** | 可視化工作流建立與管理，業務人員可自行調整處理邏輯（已有自架服務器） |
| **多模態 AI 模型** | 結合視覺理解與文字分析，處理複雜版面和掃描品質不佳的文件 |
| **企業深度整合** | 無縫對接 Microsoft 生態系統（Azure AD, SharePoint, Outlook） |
| **數據資產化** | 建立供應商分析和費用優化的數據基礎 |
| **分層 MVP 策略** | Phase 0 → MVP 0.5 → MVP 1.0 → MVP 1.5，快速驗證並逐步擴展 |

### 技術風險備註

> 以下項目需在架構設計階段詳細評估：
> - 多模態 AI API 成本估算（年處理 50 萬張文件）
> - 第三層學習機制的具體實現方式
> - Azure 服務不可用時的降級策略

---

## Project Classification

| 分類項目 | 說明 |
|---------|------|
| **Technical Type** | SaaS B2B Platform（內部使用） |
| **Domain** | Supply Chain / Logistics |
| **Complexity** | Medium-High |
| **Project Context** | Greenfield - 全新項目 |

### 技術棧

| 層次 | 技術選型 | 備註 |
|------|---------|------|
| **前端** | Next.js + React + shadcn/ui | |
| **後端** | Next.js API Routes + Python | |
| **數據庫** | PostgreSQL | 運營數據 |
| **數據倉庫** | Snowflake | 分析用途（可選） |
| **工作流** | n8n | ✅ 已有自架服務器 |
| **AI/OCR** | Azure Document Intelligence + Azure OpenAI (多模態) | |
| **存儲** | Azure Blob Storage / SharePoint | |
| **認證** | Azure AD (Entra ID) SSO | |
| **整合** | SharePoint, Outlook, Azure Storage Account | |

---

## Success Criteria

### User Success

#### Amy（數據處理專員）的成功標準

| 成功指標 | 衡量方式 | 目標值 |
|---------|---------|--------|
| **處理時間縮短** | 每張發票處理時間 | 從 5 分鐘降至 < 1 分鐘 |
| **錯誤率下降** | 數據錄入錯誤率 | 從 ~5% 降至 < 1% |
| **自動化體驗** | 無需人工提取的比例 | ≥ 90% 發票自動處理 |
| **工作負擔減輕** | 每人每日處理量提升 | 從 80-100 張提升至 400-500 張 |

**成功宣言：**
> 「我不用再一張一張打開 PDF 抄數據了，系統已經幫我做好，我只要確認一下就可以了！而且錯誤比以前少很多。」

#### David（SCM 經理）的成功標準

| 成功指標 | 衡量方式 | 目標值 |
|---------|---------|--------|
| **數據完整性** | 費用明細覆蓋率 | 100% 費用項目都有記錄 |
| **明細顆粒度** | 每張發票的費用項目 | 逐項提取，非僅匯總 |
| **分析能力** | 可產出的分析報告類型 | 供應商比較、費用趨勢、異常檢測 |
| **決策支持** | 基於數據的決策次數 | 每月至少 1 個數據驅動決策 |

**成功宣言：**
> 「終於有完整的費用明細可以做分析了！上次用這些數據和 Forwarder 談判，省下了可觀成本！」

### Business Success

#### 短期目標（3 個月 - 香港試行期）

| 目標 | 具體指標 | 驗收標準 |
|------|---------|---------|
| **全面自動化** | 所有香港發票都經過系統處理 | 100% 發票進入系統 |
| **準確率** | AI 分類正確率 | ≥ 90% |
| **自動匹配率** | 無需人工介入的比例 | ≥ 90% |
| **用戶採用** | 香港團隊每日使用系統 | 100% 採用率 |
| **效率提升** | 處理時間降低 | ≥ 70% |

#### 長期目標（12 個月 - 全面推廣）

| 目標 | 具體指標 | 驗收標準 |
|------|---------|---------|
| **地區覆蓋** | APAC 城市部署數量 | 11 個城市全部上線 |
| **準確率** | AI 分類正確率 | ≥ 95% |
| **Forwarder 覆蓋** | 支援的 Forwarder 數量 | 全部 45+ 個 |
| **數據統一** | 跨城市數據格式一致性 | 100% 統一格式 |
| **人時節省** | 年節省人工時數 | 35,000-40,000 人時/年 |

#### 失敗標準與調整觸發點

| 風險情境 | 觸發條件 | 應對措施 |
|---------|---------|---------|
| **準確率不達標** | 試行 2 個月後準確率 < 80% | 暫停推廣，專注優化映射規則 |
| **準確率嚴重不足** | 試行 3 個月後準確率 < 70% | 重新評估技術方案，考慮調整架構 |
| **用戶採用率低** | 試行 1 個月後採用率 < 50% | 深入調查原因，加強培訓和支援 |
| **用戶強烈抵觸** | NPS < 0 或重大投訴 | 暫停上線，收集反饋重新設計 |
| **系統穩定性差** | uptime < 95% 持續 2 週 | 停止新功能開發，專注修復 |

### Technical Success

| 指標 | 目標值 | 說明 |
|------|--------|------|
| **系統可用性** | 99.5% uptime | 月度計算，計劃維護除外 |
| **並發處理能力** | 50 個用戶同時使用 | 系統不出現明顯延遲 |
| **API 響應時間** | < 30 秒/張 | Azure DI + OpenAI 處理時間 |
| **OCR 提取準確率** | ≥ 98% | 字符級別準確率 |
| **結構化數據完整性** | ≥ 99% | 必填欄位完整率 |
| **安全性** | Azure AD SSO | 企業級身份認證 |

#### 恢復與可靠性指標

| 指標 | 目標值 | 說明 |
|------|--------|------|
| **RPO（恢復點目標）** | < 1 小時 | 數據最多丟失 1 小時 |
| **RTO（恢復時間目標）** | < 4 小時 | 系統恢復上線時間 |
| **MTTR（平均恢復時間）** | < 2 小時 | 一般故障平均修復時間 |
| **批量處理能力** | ≥ 500 張/小時 | 正常負載下的處理速度 |
| **峰值處理能力** | ≥ 1000 張/小時 | 月結期間的處理能力 |

#### 業務連續性計劃

**系統故障時的 Fallback 流程：**
```
┌─────────────────────────────────────────────────────────────┐
│ 系統故障時的處理流程                                         │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  1. 故障發現（自動告警或用戶回報）                           │
│       ↓                                                      │
│  2. IT 評估故障等級                                          │
│       ├── 輕微（< 30 分鐘可修復）→ 用戶等待                  │
│       └── 嚴重（> 30 分鐘）→ 啟動手動流程                    │
│       ↓                                                      │
│  3. 手動處理模式                                             │
│       • 緊急發票：使用 Excel 模板手動處理                    │
│       • 非緊急發票：累積至系統恢復後批量處理                 │
│       ↓                                                      │
│  4. 系統恢復後                                               │
│       • 優先處理積壓發票                                     │
│       • 驗證手動處理數據的一致性                             │
│       • 補錄系統處理記錄                                     │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

### Measurable Outcomes

#### 自動化率定義與計算方式

| 分類 | 定義 | 計入自動化率 |
|------|------|-------------|
| **完全自動** | 信心度 > 90%，無需任何人工介入 | ✅ 100% |
| **輔助自動** | 需要人工確認但不需修正 | ✅ 100% |
| **部分人工** | 需要人工修正 1-3 個欄位 | ❌ 不計入 |
| **完全人工** | 需要人工處理大部分內容 | ❌ 不計入 |

**自動化率公式：**
```
自動化率 = (完全自動 + 輔助自動) / 總發票數 × 100%
```

#### 黃金標準測試數據集

| 項目 | 規格 | 用途 |
|------|------|------|
| **數據集規模** | 500-1000 張已標註發票 | 系統準確率驗證 |
| **覆蓋範圍** | 涵蓋 Top 20 Forwarder | 確保代表性 |
| **標註內容** | 每張發票的正確分類結果 | 作為比對基準 |
| **建立時機** | Phase 0 期間完成 | MVP 0.5 前準備好 |
| **更新頻率** | 每季度更新 10% | 保持數據時效性 |

**準確率測量方法：**
```
準確率 = 系統分類結果與黃金標準一致的數量 / 測試數據集總數 × 100%
```

#### 核心 KPI 儀表板

| KPI | 試行期 (3M) | Phase 2 (6M) | 長期 (12M) |
|-----|------------|--------------|------------|
| **自動化率** | ≥ 90% | ≥ 92% | ≥ 95% |
| **AI 準確率** | ≥ 90% | ≥ 92% | ≥ 95% |
| **人工介入率** | ≤ 10% | ≤ 8% | ≤ 5% |
| **用戶滿意度 (NPS)** | > 30 | > 35 | > 40 |
| **城市覆蓋** | 1 (香港) | 5 | 11 (全部) |
| **Forwarder 覆蓋** | Top 10 (85%) | Top 30 (95%) | 全部 (100%) |

#### 用戶反饋機制

| 反饋類型 | 頻率 | 樣本量 | 負責人 |
|---------|------|--------|--------|
| **NPS 調查** | 每月 | 全部活躍用戶 | PM |
| **問題反饋** | 實時 | 系統內建反饋按鈕 | IT Support |
| **深度訪談** | 每季度 | 5-10 位代表用戶 | UX |
| **使用數據分析** | 每週 | 全部用戶行為 | 數據分析 |

### Compliance & Audit Requirements

#### 數據保留與追溯

| 項目 | 要求 | 說明 |
|------|------|------|
| **數據保留期限** | 7 年 | 符合財務審計要求 |
| **原始文件保留** | 與數據同步保留 | 可追溯至原始發票 |
| **修改記錄** | 完整記錄所有變更 | 包含修改人、時間、原因 |
| **審計日誌** | 不可刪除、不可篡改 | 獨立存儲 |

#### 審計支援能力

| 審計需求 | 系統能力 |
|---------|---------|
| **數據追溯** | 從任何數據點追溯至原始發票 |
| **變更歷史** | 完整的修改記錄查詢 |
| **匯出報告** | 支援審計所需的標準報告格式 |
| **訪問記錄** | 誰在什麼時間訪問了什麼數據 |

### Regional Rollout Success Criteria

每個新城市上線需達到以下標準：

| 標準項目 | 目標值 | 驗證方式 |
|---------|--------|---------|
| **本地化配置** | 100% 完成 | 配置清單檢核 |
| **本地 Forwarder 覆蓋** | ≥ 80% 當地常用 | Forwarder 列表比對 |
| **用戶培訓完成** | 100% 目標用戶 | 培訓記錄 |
| **Super User 指定** | ≥ 1 人/城市 | 人員名單確認 |
| **試運行通過** | 連續 5 天無重大問題 | 問題追蹤記錄 |
| **數據遷移驗證** | 100% 數據完整性 | 數據比對報告 |

---

## Product Scope

### MVP - Minimum Viable Product

採用分層 MVP 策略，快速驗證核心假設後逐步擴展：

#### Phase 0: 數據分析（3-4 週）
- 歷史文件分析（過去 12 個月）
- 文件類型識別和分佈統計
- 初始 Forwarder Profile 建立
- 初始 Universal Mapping 規則（≥ 300 條）
- **建立黃金標準測試數據集（500-1000 張）**
- **並行**：基礎架構搭建

#### MVP 0.5: 快速驗證（2-4 週）
- OCR 提取（Azure Document Intelligence）
- AI 分類（2 層映射架構）
- 基本審核界面（確認/修正）
- 手動上傳文件
- Excel 結果導出
- **基本監控和告警機制**

#### MVP 1.0: 完整試行（4-6 週）
- 信心度評分顯示
- SharePoint/Outlook 整合
- 基本儀表板
- Forwarder Profile 管理界面
- Azure AD 登入
- **審計日誌和修改記錄**
- **用戶反饋收集機制**

### Growth Features (Post-MVP)

#### MVP 1.5: 優化擴展
- 完整管理員配置界面
- 多語言支援
- 進階報表和分析
- 第 3 層學習映射研究
- 批量處理效能優化
- **災難恢復機制**

#### Phase 2: 區域擴展（Month 4-6）
- 從香港擴展到 5 個 APAC 城市
- 從 Top 10 擴展到 Top 30 Forwarder
- 準確率目標 92%+
- **標準化城市上線流程**

### Vision (Future)

#### Phase 3: 全面覆蓋（Month 7-12）
- 11 個 APAC 城市全部部署
- 覆蓋所有已知 Forwarder
- 準確率目標 95%+
- 高級分析（供應商比較、異常檢測）

#### 長期願景（Year 2+）
- 全球擴展（APAC → 全球）
- 準確率 98%+，極少人工介入
- 供應商績效評估和議價建議
- Forwarder 直接數據對接
- API 開放給其他業務系統

---

## User Journeys

### Journey 1: Amy Chen（數據處理專員）

**角色背景：**
- 職責：每日處理 150-200 張 Freight Invoice
- 痛點：重複性的手動數據錄入工作，容易疲勞出錯
- 目標：從低價值工作解放，專注於例外處理和品質把關

**主要旅程：日常發票處理**

| 階段 | 用戶行為 | 系統響應 | 成功標準 |
|------|---------|---------|---------|
| 1. 登入 | 使用 Azure AD SSO 登入 | 顯示待處理發票列表 | < 3 秒載入 |
| 2. 查看待處理 | 瀏覽今日待處理發票 | 顯示發票數量、來源、優先級 | 清晰的任務總覽 |
| 3. 處理高信心度 | 快速掃視自動處理結果 | 信心度 >90% 的發票已自動完成 | 無需人工介入 |
| 4. 審核中等信心度 | 確認 70-90% 信心度的提取結果 | 高亮顯示需確認的欄位 | 一鍵確認或修正 |
| 5. 處理低信心度 | 完整審核 <70% 信心度的發票 | 顯示原始文件與提取結果對照 | 方便比對修正 |
| 6. 提交結果 | 確認處理完成 | 更新狀態，觸發後續流程 | 即時反饋 |

**次要旅程：修正與學習反饋**

| 階段 | 用戶行為 | 系統響應 |
|------|---------|---------|
| 1. 發現錯誤 | 在審核中發現提取錯誤 | 提供修正界面 |
| 2. 修正數據 | 輸入正確值 | 記錄修正內容 |
| 3. 標記規則 | 標注是否為常見錯誤 | 納入學習庫（3 次確認升級） |

---

### Journey 2: David Wong（SCM 經理）

**角色背景：**
- 職責：管理供應鏈成本，進行供應商議價
- 痛點：缺乏完整的費用明細數據做分析
- 目標：獲取可信賴的數據支持決策

**主要旅程：費用分析與供應商比較**

| 階段 | 用戶行為 | 系統響應 | 成功標準 |
|------|---------|---------|---------|
| 1. 登入 | Azure AD SSO | 顯示管理者儀表板 | 權限正確 |
| 2. 查看總覽 | 瀏覽處理統計和自動化率 | 顯示 KPI 儀表板 | 即時數據 |
| 3. 匯出報表 | 選擇時間範圍和維度 | 生成費用明細報表 | 完整明細 |
| 4. 下載數據 | 導出 Excel | 提供格式化的數據文件 | 欄位完整 |
| 5. 進行分析 | 在 Excel 中做供應商比較 | N/A（系統外操作） | 數據可用 |

**次要旅程：審計支援**

| 階段 | 用戶行為 | 系統響應 |
|------|---------|---------|
| 1. 收到審計需求 | 需要特定期間的發票記錄 | - |
| 2. 查詢歷史 | 輸入查詢條件 | 顯示符合條件的記錄 |
| 3. 追溯原始 | 點擊記錄查看詳情 | 連結至原始發票文件 |
| 4. 匯出審計報告 | 選擇報告格式 | 生成符合審計要求的報告 |

---

### Journey 3: Kevin Lam（Super User）

**角色背景：**
- 職責：支援本地團隊，處理複雜案例
- 痛點：需要處理 Amy 無法解決的例外情況
- 目標：高效處理例外，改善系統規則

**主要旅程：例外處理與規則優化**

| 階段 | 用戶行為 | 系統響應 | 成功標準 |
|------|---------|---------|---------|
| 1. 接收升級案例 | 收到 Amy 升級的發票 | 顯示問題描述和處理歷史 | 完整上下文 |
| 2. 分析問題 | 查看原始文件和提取結果 | 並排顯示比對界面 | 清晰對照 |
| 3. 判斷原因 | 識別是格式問題或規則問題 | 提供診斷工具 | 快速定位 |
| 4. 修正數據 | 輸入正確值 | 記錄修正 | 即時生效 |
| 5. 建議規則 | 提出新規則建議 | 記錄到待審核規則庫 | 持續改善 |

**次要旅程：Forwarder Profile 維護**

| 階段 | 用戶行為 | 系統響應 |
|------|---------|---------|
| 1. 發現新格式 | 某 Forwarder 使用新的發票格式 | - |
| 2. 檢視 Profile | 查看現有 Forwarder Profile | 顯示目前的映射規則 |
| 3. 更新規則 | 調整或新增映射規則 | 保存並標記為待驗證 |
| 4. 測試規則 | 使用測試發票驗證 | 顯示測試結果 |

---

### Journey 4: Tony（系統管理員）

**角色背景：**
- 職責：維護系統運作，管理用戶權限
- 痛點：需要監控系統健康，快速響應問題
- 目標：確保系統穩定運行，99.5% uptime

**主要旅程：系統監控與維護**

| 階段 | 用戶行為 | 系統響應 | 成功標準 |
|------|---------|---------|---------|
| 1. 查看系統狀態 | 登入管理後台 | 顯示系統健康儀表板 | 即時狀態 |
| 2. 監控 Azure 服務 | 檢查 AI 服務狀態 | 顯示 API 調用量和響應時間 | 異常告警 |
| 3. 管理用戶 | 新增/修改用戶權限 | Azure AD 整合的權限管理 | 即時生效 |
| 4. 查看日誌 | 檢視系統日誌和錯誤 | 結構化的日誌查詢界面 | 快速定位 |
| 5. 處理告警 | 響應系統告警 | 提供問題診斷信息 | 快速恢復 |

**次要旅程：問題排查**

| 階段 | 用戶行為 | 系統響應 |
|------|---------|---------|
| 1. 收到問題報告 | 用戶反映系統問題 | - |
| 2. 查詢日誌 | 搜索相關時段的日誌 | 顯示詳細日誌記錄 |
| 3. 追蹤請求 | 追蹤特定發票的處理流程 | 顯示完整處理鏈 |
| 4. 識別問題 | 分析錯誤原因 | 提供診斷建議 |
| 5. 修復或升級 | 執行修復或升級至開發團隊 | 記錄處理結果 |

---

### Journey 5: Eric（n8n 工作流管理員）

**角色背景：**
- 職責：在 n8n 平台上建立和管理自動化工作流
- 工作環境：n8n 自架服務器
- 目標：設計高效的文件處理流程，確保工作流穩定運行

**主要旅程：工作流監控與觸發（在本系統內）**

| 階段 | 用戶行為 | 系統響應 | 成功標準 |
|------|---------|---------|---------|
| 1. 查看工作流狀態 | 登入本系統查看 n8n 連接狀態 | 顯示工作流健康狀態 | 即時同步 |
| 2. 監控執行記錄 | 查看最近的工作流執行結果 | 顯示成功/失敗統計 | 清晰可見 |
| 3. 手動觸發 | 需要時手動觸發特定工作流 | 發送觸發請求到 n8n | 即時響應 |
| 4. 查看錯誤 | 檢視工作流執行錯誤 | 顯示錯誤詳情和上下文 | 快速診斷 |
| 5. 追蹤文件狀態 | 追蹤特定文件的處理進度 | 顯示工作流執行階段 | 完整追蹤 |

**次要旅程：工作流設計與管理（在 n8n 平台）**

| 階段 | 用戶行為 | 系統響應 |
|------|---------|---------|
| 1. 設計工作流 | 在 n8n 中設計新的處理流程 | n8n 可視化編輯器 |
| 2. 配置節點 | 配置與本系統的 API 連接 | 提供 API 文檔和範例 |
| 3. 測試工作流 | 使用測試數據驗證 | 返回測試結果 |
| 4. 部署上線 | 啟用工作流 | 確認連接正常 |

**與本系統的整合點：**
- API 端點：供 n8n 調用的文件處理 API
- Webhook：接收 n8n 的回調通知
- 狀態同步：工作流執行狀態的雙向同步
- 告警整合：n8n 錯誤同步到本系統告警

---

### Journey 6: Michelle（財務人員）

**角色背景：**
- 職責：核對費用數據，處理付款審批
- 痛點：數據分散，核對工作繁瑣
- 目標：快速獲取準確的費用匯總

**主要旅程：費用核對與審批**

| 階段 | 用戶行為 | 系統響應 | 成功標準 |
|------|---------|---------|---------|
| 1. 登入 | Azure AD SSO | 顯示財務視圖 | 權限正確 |
| 2. 查看待核對 | 瀏覽待財務核對的記錄 | 顯示待核對列表 | 清晰分類 |
| 3. 核對明細 | 檢視費用明細與原始發票 | 並排顯示對照 | 方便核對 |
| 4. 標記結果 | 確認或標記異常 | 記錄核對結果 | 即時更新 |
| 5. 匯出報表 | 導出財務報表 | 生成標準格式報表 | 格式正確 |

---

### Journey 7: James（審計人員）

**角色背景：**
- 職責：進行內部/外部審計
- 痛點：需要追溯大量歷史記錄
- 目標：完整的審計軌跡和原始文件追溯

**主要旅程：審計追溯**

| 階段 | 用戶行為 | 系統響應 | 成功標準 |
|------|---------|---------|---------|
| 1. 登入 | Azure AD SSO（審計權限） | 顯示審計視圖 | 唯讀權限 |
| 2. 設定查詢 | 輸入審計期間和條件 | 接受查詢條件 | 靈活篩選 |
| 3. 查看結果 | 瀏覽符合條件的記錄 | 顯示完整記錄列表 | 無遺漏 |
| 4. 追溯詳情 | 點擊記錄查看完整歷史 | 顯示所有變更記錄 | 完整軌跡 |
| 5. 查看原始文件 | 連結至原始發票 | 顯示原始 PDF/圖片 | 可追溯 |
| 6. 匯出審計報告 | 選擇報告格式 | 生成審計報告 | 符合規範 |

---

### User Journey Requirements Summary

| 用戶角色 | 主要需求 | 關鍵界面 | 權限等級 |
|---------|---------|---------|---------|
| Amy（數據處理） | 高效處理發票、一鍵確認 | 處理隊列、審核界面 | 基本用戶 |
| David（SCM 經理） | 費用分析、報表匯出 | 儀表板、報表中心 | 管理者 |
| Kevin（Super User） | 例外處理、規則優化 | 診斷工具、規則管理 | 進階用戶 |
| Tony（系統管理員） | 系統監控、用戶管理 | 管理後台、日誌查詢 | 管理員 |
| Eric（n8n 管理員） | 工作流監控、API 整合 | 工作流狀態、API 文檔 | 整合用戶 |
| Michelle（財務） | 費用核對、報表匯出 | 財務視圖、核對界面 | 財務用戶 |
| James（審計） | 審計追溯、完整歷史 | 審計視圖、追溯工具 | 審計用戶（唯讀） |

---

## Innovation & Novel Patterns

### Detected Innovation Areas

| 創新領域 | 描述 | 相較傳統方案的優勢 | MVP 優先級 |
|---------|------|-------------------|-----------|
| **三層智能映射架構** | Universal Mapping + Forwarder-Specific + AI Learning | 規則數量從 9,000 降至 800，維護成本降低 90%+ | 🔴 P0 - 核心 |
| **信心度驅動處理** | 非二元的自動化決策，分層處理策略 | 平衡效率與品質，避免過度自動化風險 | 🔴 P0 - 核心 |
| **持續學習閉環** | 人工修正 → 學習庫 → 3 次確認 → 正式規則 | 系統自動優化，無需持續開發介入 | 🟡 P1 - Post-MVP |
| **n8n 工作流整合** | 可視化工作流設計，業務人員可自行調整 | 降低 IT 依賴，快速響應業務變化 | 🟢 P2 - 增強 |
| **多模態 AI 應用** | OCR + 視覺理解雙軌處理 | 處理複雜版面和低品質掃描文件 | 🟡 P1 - 按需啟用 |

### 創新價值量化

#### 維護成本對比

| 指標 | 傳統方案 | 本方案 | 節省 |
|------|---------|--------|------|
| **規則數量** | ~9,000 條 | ~800 條 | 91% |
| **新增 Forwarder 時間** | 2-3 週（建立所有規則） | 2-3 天（僅需特定規則） | 80%+ |
| **規則維護人力** | 2-3 人專職 | 0.5 人兼職 | 75%+ |
| **年度維護成本（估計）** | HKD 800K-1.2M | HKD 150K-250K | 70-80% |

#### 競爭壁壘分析

| 壁壘類型 | 描述 | 競爭對手複製難度 |
|---------|------|-----------------|
| **數據資產** | 學習庫持續積累的修正規則 | 高 - 需要相同數據量訓練 |
| **領域知識** | Freight Invoice 專屬映射邏輯 | 中 - 需要領域專家投入 |
| **用戶習慣** | 用戶熟悉度和工作流整合 | 中 - 需要遷移成本 |
| **先發優勢** | 預計 6-12 個月的市場領先 | 時間窗口有限 |

### Market Context & Competitive Landscape

#### 現有方案比較

| 方案類型 | 代表產品 | 優勢 | 局限 |
|---------|---------|------|------|
| **傳統 OCR** | ABBYY, Tesseract | 成熟、穩定 | 僅文字提取，無智能分類 |
| **文件 AI 平台** | Azure Form Recognizer, AWS Textract | 雲端服務、API 整合 | 通用模型，需大量自定義 |
| **發票自動化** | Basware, Coupa | 完整 AP 流程 | 昂貴、難以自定義、通常針對西方格式 |
| **RPA 方案** | UiPath, Automation Anywhere | 流程自動化 | 維護成本高、脆弱性強 |

#### 本方案差異化

1. **專注垂直領域**：Freight Invoice 專屬優化，非通用文件處理
2. **自適應學習**：持續學習機制減少長期維護成本
3. **靈活整合**：n8n 低代碼整合，適應企業既有系統
4. **成本效益**：內部工具定位，無需支付高額 SaaS 訂閱

### 學習機制技術細節

#### 規則升級流程

```
┌─────────────────────────────────────────────────────────────────┐
│ 學習機制流程                                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  1. 用戶修正數據                                                  │
│       ↓                                                          │
│  2. 系統記錄修正                                                  │
│       • 原始值 vs 修正值                                          │
│       • Forwarder + 欄位 + 位置模式                               │
│       • 用戶標記：「正常修正」或「特例，不學習」                    │
│       ↓                                                          │
│  3. 模式匹配判定                                                  │
│       • 同一 Forwarder + 同一欄位 + 相似位置模式                   │
│       • 相似度閾值 ≥ 85%                                          │
│       ↓                                                          │
│  4. 累計確認次數                                                  │
│       • 不同用戶的修正各計 1 次                                    │
│       • 同一用戶的重複修正僅計 1 次                                │
│       ↓                                                          │
│  5. 升級前影響分析                                                │
│       • 計算：此規則會影響多少現有發票？                           │
│       • 高影響（>100 張）：需 Super User 審核                      │
│       • 低影響（≤100 張）：自動升級                                │
│       ↓                                                          │
│  6. 規則版本控制                                                  │
│       • 版本號：v{date}-{seq}                                     │
│       • 保留前 5 個版本供回滾                                      │
│       • 記錄升級原因和影響範圍                                     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 規則衝突處理

| 衝突類型 | 處理方式 |
|---------|---------|
| **新規則 vs 現有規則** | 新規則優先級較低，需人工審核 |
| **Forwarder 規則 vs Universal 規則** | Forwarder 優先 |
| **學習規則 vs 手動規則** | 手動規則優先 |

#### 自動回滾機制

| 觸發條件 | 動作 |
|---------|------|
| 升級後 24 小時內準確率下降 > 5% | 自動回滾 + 通知 Super User |
| 用戶投訴同一規則 ≥ 3 次 | 暫停規則 + 人工審核 |
| 影響範圍超出預期 200% | 自動回滾 + 告警 |

### 多模態 AI 觸發策略

#### 觸發條件

| 情境 | 處理方式 | 成本影響 |
|------|---------|---------|
| **純 OCR 成功** | 僅使用 Azure Document Intelligence | 基礎成本 |
| **OCR 信心度 < 70%** | 觸發多模態 AI 輔助 | +50% 成本 |
| **已知困難 Forwarder** | 預設使用多模態 | +50% 成本 |
| **用戶手動請求** | 觸發多模態重新處理 | +50% 成本 |

#### 降級策略

```
正常模式：Azure DI + Azure OpenAI (多模態)
    ↓ (API 不可用或超時 > 30s)
降級模式 1：僅 Azure DI + 規則映射
    ↓ (Azure DI 不可用)
降級模式 2：排隊等待 + 通知用戶
    ↓ (等待 > 2 小時)
降級模式 3：標記為「需人工處理」
```

### Validation Approach

#### 創新驗證策略

| 創新元素 | 驗證方法 | 成功標準 | 驗證時機 |
|---------|---------|---------|---------|
| **三層映射架構** | 黃金標準數據集測試 + 回歸自動化 | ≥90% 準確率 | MVP 0.5 |
| **信心度機制** | A/B 測試框架 | 找到最佳閾值平衡點 | MVP 0.5 |
| **持續學習機制** | 影響分析 + 回滾測試 | 升級成功率 ≥ 95% | MVP 1.0 後 |
| **n8n 整合** | E2E 測試覆蓋 | 非技術人員可獨立調整 | MVP 1.0 |
| **多模態 AI** | 成本/效益追蹤 | ROI > 1.5x | MVP 0.5 |

#### 黃金標準數據集管理

| 項目 | 規格 | 管理方式 |
|------|------|---------|
| **規模** | 500-1000 張已標註發票 | Git LFS 版本控制 |
| **覆蓋** | Top 20 Forwarder | 每個至少 25 張 |
| **邊界案例** | 至少 100 張困難案例 | 系統性分類標籤 |
| **更新頻率** | 每季度 10% | PR 審核流程 |
| **標註品質** | 雙人交叉驗證 | 不一致時第三人裁決 |

### Risk Mitigation

#### 創新風險與應對

| 風險項目 | 風險等級 | 應對策略 | Fallback 方案 | 量化閾值 |
|---------|---------|---------|--------------|---------|
| **三層架構複雜度** | 中 | MVP 先實現兩層 | 退回純規則方案 | - |
| **AI 學習品質** | 中 | 影響分析 + 人工審核閘門 | 暫停學習，僅用固定規則 | 準確率下降 > 5% |
| **多模態 AI 成本** | 高 | 成本監控 + 選擇性使用 | 僅高價值案例使用 | 見下表 |
| **n8n 穩定性** | 低 | 監控告警 + 錯誤重試 | 手動觸發替代 | uptime < 99% |
| **Azure 服務依賴** | 中 | 多層降級策略 | 離線排隊處理 | 不可用 > 30 分鐘 |

#### 成本監控量化閾值

| 指標 | 預算 | 告警閾值 | 自動降級閾值 |
|------|------|---------|-------------|
| **每張發票 AI 成本** | HKD 0.50 | > HKD 0.75 | > HKD 1.00 |
| **月度 AI API 總成本** | HKD 25,000 | > HKD 30,000 | > HKD 40,000 |
| **多模態觸發率** | 20% | > 30% | > 50% |

### User Experience Considerations

#### 學習機制的透明度設計

| UX 元素 | 設計原則 | 實現方式 |
|--------|---------|---------|
| **修正時的提示** | 告知用戶修正會被學習 | 「此修正將幫助系統學習」提示 |
| **特例標記** | 給用戶控制權 | 「標記為特例（不學習）」選項 |
| **影響可見性** | 讓用戶看到貢獻 | 「你的修正已幫助處理 XX 張發票」 |
| **規則升級通知** | 慶祝用戶貢獻 | 「🎉 你的修正已升級為正式規則！」 |

#### 信心度視覺設計

| 信心度範圍 | 顏色 | 圖示 | 用戶動作 |
|-----------|------|------|---------|
| **> 90%** | 🟢 綠色 | ✓ | 自動處理，可跳過 |
| **70-90%** | 🟡 黃色 | ⚠ | 快速確認 |
| **< 70%** | 🔴 紅色 | ✗ | 完整審核 |

**信心度詳情顯示：**
- 滑鼠懸停顯示「為什麼信心度低？」
- 列出不確定的具體欄位
- 顯示 AI 的替代建議（如有）

#### 個人化偏好

允許用戶調整個人的信心度閾值偏好：
- 「我更注重效率」→ 降低需要審核的閾值
- 「我更注重品質」→ 提高需要審核的閾值

### MVP 架構簡化策略

遵循 **Boring Technology** 原則，MVP 階段採用簡化架構：

| 階段 | 實現範圍 | 說明 |
|------|---------|------|
| **MVP 0.5** | 兩層架構（Universal + Forwarder-Specific） | 驗證核心價值 |
| **MVP 1.0** | 加入信心度機制 + 基本監控 | 完整用戶體驗 |
| **MVP 1.5** | 第三層學習機制 | 驗證學習效果 |
| **Post-MVP** | 多模態 AI 全面啟用 + 進階分析 | 效能優化 |

### 技術債務預防

- MVP 階段保持架構簡潔，避免過早優化
- 建立清晰的技術文檔，降低知識依賴
- 定期 Code Review 確保代碼品質
- 監控 AI API 成本，設置預算告警
- 學習機制上線前完成安全閥測試

---

## SaaS B2B Platform Specific Requirements

### Project-Type Overview

本系統是一個**企業內部 SaaS B2B 平台**，服務於公司 APAC 地區 11 個城市的辦公室。雖然是內部工具，但採用 SaaS 架構模式以支援多城市部署、權限管理和未來擴展。

**關鍵特性：**
- 多城市部署，數據嚴格隔離
- 靈活的角色權限管理（系統內管理 + 自定義角色）
- 全局共享規則，降低維護成本
- 使用量追蹤支援成本分攤
- 對外 API 支援系統整合

### Multi-City Data Architecture（多城市數據架構）

#### 數據隔離模型

```
┌─────────────────────────────────────────────────────────────────┐
│ 多城市數據隔離架構                                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                    全局共享層                            │    │
│  │  • Universal Mapping Rules                               │    │
│  │  • Forwarder Profiles                                    │    │
│  │  • System Configuration                                  │    │
│  │  • AI Learning Rules（經審核後）                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                           │                                      │
│         ┌─────────────────┼─────────────────┐                   │
│         ↓                 ↓                 ↓                   │
│  ┌──────────┐      ┌──────────┐      ┌──────────┐              │
│  │  香港    │      │  新加坡  │      │  上海    │  ...         │
│  │  City    │      │  City    │      │  City    │              │
│  │  ────    │      │  ────    │      │  ────    │              │
│  │ 發票數據 │      │ 發票數據 │      │ 發票數據 │              │
│  │ 處理記錄 │      │ 處理記錄 │      │ 處理記錄 │              │
│  │ 審計日誌 │      │ 審計日誌 │      │ 審計日誌 │              │
│  │ 用戶活動 │      │ 用戶活動 │      │ 用戶活動 │              │
│  └──────────┘      └──────────┘      └──────────┘              │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 數據隔離原則

| 數據類型 | 隔離級別 | 說明 |
|---------|---------|------|
| **發票數據** | 城市級嚴格隔離 | 各城市僅能訪問本城市數據 |
| **處理記錄** | 城市級嚴格隔離 | 包含處理歷史和修正記錄 |
| **審計日誌** | 城市級嚴格隔離 | 符合本地審計要求 |
| **用戶數據** | 城市級 + 全局角色 | 用戶歸屬城市，但可有跨城市權限 |
| **Mapping Rules** | 全局共享 | 所有城市使用相同規則庫 |
| **Forwarder Profiles** | 全局共享 | 統一的 Forwarder 配置 |
| **系統配置** | 全局共享 | 統一的系統設定 |

#### 跨城市查詢機制

| 角色類型 | 訪問範圍 | 實現方式 |
|---------|---------|---------|
| **城市用戶** | 僅本城市 | 預設權限，無需配置 |
| **區域管理者** | 指定多城市 | 明確授權城市列表 |
| **全局管理者** | 所有城市 | 最高權限，需審批 |

### RBAC Permission Matrix（角色權限矩陣）

#### 權限管理架構

```
┌─────────────────────────────────────────────────────────────────┐
│ 權限管理架構                                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────┐                                                │
│  │  Azure AD   │ ← 身份認證（SSO 登入）                         │
│  └──────┬──────┘                                                │
│         ↓                                                        │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │              系統內權限管理                               │    │
│  │  ┌───────────────┐  ┌───────────────┐                   │    │
│  │  │  角色定義     │  │  權限分配     │                   │    │
│  │  │  (可自定義)   │  │  (用戶↔角色)  │                   │    │
│  │  └───────────────┘  └───────────────┘                   │    │
│  │  ┌───────────────┐  ┌───────────────┐                   │    │
│  │  │  城市歸屬     │  │  功能權限     │                   │    │
│  │  │  (數據範圍)   │  │  (操作範圍)   │                   │    │
│  │  └───────────────┘  └───────────────┘                   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 預設角色定義

| 角色 | 數據範圍 | 核心權限 | 可自定義 |
|------|---------|---------|---------|
| **數據處理員** | 本城市 | 處理發票、修正數據、提交審核 | ✅ |
| **Super User** | 本城市 | 處理例外、維護規則、審核學習規則 | ✅ |
| **城市經理** | 本城市 | 查看報表、匯出數據、用戶管理 | ✅ |
| **區域經理** | 指定多城市 | 跨城市報表、區域分析 | ✅ |
| **n8n 管理員** | 全局 | 工作流監控、API 管理 | ✅ |
| **財務人員** | 本城市 | 費用核對、財務報表 | ✅ |
| **審計人員** | 本城市/區域 | 唯讀、審計追溯 | ✅ |
| **系統管理員** | 全局 | 用戶管理、系統配置、角色定義 | ❌ |

#### 權限矩陣詳細

| 功能模組 | 數據處理員 | Super User | 城市經理 | 區域經理 | 系統管理員 |
|---------|-----------|------------|---------|---------|-----------|
| **發票處理** | ✅ CRUD | ✅ CRUD | ❌ | ❌ | ❌ |
| **數據審核** | ✅ 提交 | ✅ 審核 | ❌ | ❌ | ❌ |
| **規則管理** | ❌ | ✅ 建議+審核 | ❌ | ❌ | ✅ 全局管理 |
| **報表查看** | ✅ 基本 | ✅ 進階 | ✅ 完整 | ✅ 跨城市 | ✅ 全局 |
| **數據匯出** | ❌ | ✅ 本城市 | ✅ 本城市 | ✅ 跨城市 | ✅ 全局 |
| **用戶管理** | ❌ | ❌ | ✅ 本城市 | ❌ | ✅ 全局 |
| **系統配置** | ❌ | ❌ | ❌ | ❌ | ✅ |
| **審計日誌** | ❌ | ✅ 唯讀 | ✅ 唯讀 | ✅ 唯讀 | ✅ 完整 |

#### 自定義角色功能

| 功能 | 說明 |
|------|------|
| **角色複製** | 基於現有角色創建新角色 |
| **權限組合** | 自由組合功能權限 |
| **城市範圍** | 指定可訪問的城市列表 |
| **時效限制** | 可設定角色有效期（如：臨時審計） |
| **審批流程** | 高權限角色需要審批 |

### Usage Tracking & Cost Allocation（使用量追蹤與成本分攤）

#### 追蹤指標

| 指標類型 | 追蹤項目 | 分攤基礎 |
|---------|---------|---------|
| **處理量** | 發票處理數量 | 按城市統計 |
| **AI API 調用** | Azure DI + OpenAI 調用次數 | 按城市統計 |
| **存儲使用** | 文件存儲容量 | 按城市統計 |
| **用戶數** | 活躍用戶數量 | 按城市統計 |

#### 成本分攤模型

```
┌─────────────────────────────────────────────────────────────────┐
│ 月度成本分攤計算                                                  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  總成本 = 基礎設施成本 + AI API 成本 + 存儲成本                   │
│                                                                  │
│  城市分攤 = (城市處理量 / 總處理量) × 總成本                      │
│                                                                  │
│  報表輸出：                                                       │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 城市    │ 處理量  │ 佔比   │ 分攤成本                    │    │
│  │ 香港    │ 15,000  │ 30%    │ HKD 7,500                   │    │
│  │ 新加坡  │ 12,000  │ 24%    │ HKD 6,000                   │    │
│  │ 上海    │ 10,000  │ 20%    │ HKD 5,000                   │    │
│  │ ...     │ ...     │ ...    │ ...                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 成本報表功能

| 報表類型 | 頻率 | 受眾 |
|---------|------|------|
| **城市月報** | 每月 | 城市經理 |
| **區域匯總** | 每月 | 區域經理 |
| **全局總覽** | 每月 | 財務 + 系統管理員 |
| **成本趨勢** | 每季 | 管理層 |

### Integration Architecture（整合架構）

#### 已確認的整合

| 整合對象 | 整合類型 | 方向 | 優先級 | 階段 |
|---------|---------|------|--------|------|
| **Azure AD** | 身份認證 | Inbound | 高 | MVP 1.0 |
| **SharePoint** | 文件來源 | Inbound | 高 | MVP 1.0 |
| **Outlook** | 郵件附件 | Inbound | 高 | MVP 1.0 |
| **n8n** | 工作流引擎 | Bidirectional | 高 | 核心 |
| **Azure Document Intelligence** | OCR 服務 | Outbound | 高 | 核心 |
| **Azure OpenAI** | AI 服務 | Outbound | 高 | 核心 |
| **Azure Blob Storage** | 文件存儲 | Bidirectional | 高 | 核心 |
| **PostgreSQL** | 運營數據 | Bidirectional | 高 | 核心 |
| **Snowflake** | 數據倉庫 | Outbound | 中 | Post-MVP |

#### 對外 API 設計

本系統將提供 RESTful API 供外部系統整合：

| API 類別 | 端點範例 | 用途 |
|---------|---------|------|
| **文件提交** | POST /api/v1/invoices | 外部系統提交發票 |
| **狀態查詢** | GET /api/v1/invoices/{id}/status | 查詢處理狀態 |
| **結果獲取** | GET /api/v1/invoices/{id}/result | 獲取提取結果 |
| **批量查詢** | GET /api/v1/invoices?filter=... | 批量查詢發票 |
| **報表數據** | GET /api/v1/reports/... | 獲取報表數據 |
| **Webhook 註冊** | POST /api/v1/webhooks | 註冊回調通知 |

#### API 安全機制

| 安全機制 | 實現方式 |
|---------|---------|
| **認證** | Azure AD OAuth 2.0 / API Key |
| **授權** | 基於角色的 API 權限 |
| **Rate Limiting** | 每分鐘 100 請求/客戶端 |
| **審計** | 所有 API 調用記錄日誌 |
| **版本控制** | URL 版本號（/api/v1/...） |

### Compliance & Security Requirements（合規與安全需求）

#### 數據保護

| 項目 | 要求 | 實現方式 |
|------|------|---------|
| **數據加密（靜態）** | Azure 預設處理 | Azure Storage Service Encryption |
| **數據加密（傳輸）** | Azure 預設處理 | TLS 1.2+ |
| **數據保留** | 7 年 | 自動歸檔策略 |
| **數據刪除** | 依法規要求 | 安全刪除流程 |

#### 審計與追溯

| 項目 | 要求 |
|------|------|
| **操作日誌** | 記錄所有用戶操作 |
| **數據變更日誌** | 記錄所有數據修改（who, when, what） |
| **API 調用日誌** | 記錄所有 API 請求 |
| **登入日誌** | 記錄所有登入/登出事件 |
| **日誌保留** | 與數據保留期一致（7 年） |
| **日誌不可篡改** | 獨立存儲，唯讀訪問 |

#### 訪問控制

| 項目 | 要求 |
|------|------|
| **身份認證** | Azure AD SSO |
| **會話管理** | 8 小時自動登出 |
| **失敗鎖定** | 5 次失敗後鎖定 30 分鐘 |
| **密碼策略** | 由 Azure AD 統一管理 |

### Technical Architecture Considerations

#### 多城市部署選項

| 選項 | 描述 | 優勢 | 挑戰 |
|------|------|------|------|
| **單一實例 + 數據隔離** | 一個應用實例，邏輯隔離數據 | 維護簡單、成本低 | 需要完善的隔離邏輯 |
| **多實例部署** | 每城市獨立實例 | 完全隔離、本地化 | 維護複雜、成本高 |
| **混合模式** | 核心服務共享 + 數據層隔離 | 平衡成本和隔離 | 架構較複雜 |

**建議採用：單一實例 + 數據隔離**（MVP 階段）
- 所有城市共用同一應用實例
- 通過 city_id 實現數據邏輯隔離
- 全局規則庫共享
- 未來可按需遷移到混合模式

#### 數據庫設計原則

```sql
-- 所有城市數據表都包含 city_id
CREATE TABLE invoices (
    id UUID PRIMARY KEY,
    city_id VARCHAR(10) NOT NULL,  -- 'HK', 'SG', 'SH', etc.
    ...
    CONSTRAINT fk_city FOREIGN KEY (city_id) REFERENCES cities(id)
);

-- 全局共享表不包含 city_id
CREATE TABLE mapping_rules (
    id UUID PRIMARY KEY,
    rule_type VARCHAR(50),  -- 'universal', 'forwarder_specific', 'learned'
    ...
);

-- Row Level Security (RLS) 實現數據隔離
CREATE POLICY city_isolation ON invoices
    USING (city_id = current_setting('app.current_city'));
```

### Implementation Considerations

#### MVP 階段優先級

| 功能 | MVP 0.5 | MVP 1.0 | Post-MVP |
|------|---------|---------|----------|
| 單城市數據處理 | ✅ | ✅ | ✅ |
| 多城市數據隔離 | ❌ | ✅ | ✅ |
| 預設角色權限 | ✅ | ✅ | ✅ |
| 自定義角色 | ❌ | ❌ | ✅ |
| Azure AD SSO | ❌ | ✅ | ✅ |
| 使用量追蹤 | ❌ | ✅ | ✅ |
| 成本分攤報表 | ❌ | ❌ | ✅ |
| 對外 API | ❌ | 基本 | 完整 |

#### 關鍵技術決策

| 決策項目 | 選擇 | 原因 |
|---------|------|------|
| **多租戶實現** | 單一實例 + RLS | 維護簡單，成本效益高 |
| **權限管理** | 系統內管理 | 靈活支援自定義角色 |
| **API 版本控制** | URL 版本號 | 簡單直觀，易於管理 |
| **數據隔離** | PostgreSQL RLS | 數據庫層面強制隔離 |

---

## Project Scoping & Phased Development

### MVP Strategy & Philosophy

#### 選定的 MVP 策略

**主要策略：問題解決 MVP**
- 專注解決 Amy 的核心痛點：從手動數據錄入中解放
- 最小可行範圍驗證 AI 提取和分類的可行性
- 快速獲得用戶反饋，迭代優化

**次要策略：體驗 MVP**
- 提供流暢的審核體驗
- 信心度機制讓用戶感受到 AI 的價值

#### MVP 成功定義

> **Amy 說：**「我不用再一張一張打開 PDF 抄數據了，系統已經幫我做好，我只要確認一下就可以了！」

#### 資源配置

| 資源類型 | 配置 | 說明 |
|---------|------|------|
| **核心開發團隊** | 3 人全職 | 前端 + 後端 + AI/數據 |
| **n8n 工作流** | 內部人員 | 兼職配置和維護 |
| **外部資源** | 無 | 全部內部開發 |
| **業務支援** | Amy + Kevin | 提供測試數據和反饋 |

### Development Phases

#### Phase 0: 數據分析與準備

**狀態：** 🔴 尚未開始

**目標：** 為 MVP 建立數據基礎和技術驗證

| 工作項目 | 說明 | 產出 |
|---------|------|------|
| **歷史文件分析** | 分析過去 12 個月的發票 | 文件類型分佈報告 |
| **Forwarder 識別** | 識別並分類所有 Forwarder | Top 10 Forwarder Profile |
| **Universal Mapping** | 建立初始通用映射規則 | ≥ 300 條核心規則 |
| **黃金標準數據集** | 標註測試發票 | 500-1000 張已標註發票 |
| **技術 POC** | 驗證 Azure DI + OpenAI | 可行性報告 |
| **基礎架構** | 搭建開發環境 | 開發/測試環境就緒 |

**Phase 0 完成標準：**
- [ ] Top 10 Forwarder Profile 完成
- [ ] 300+ 條 Universal Mapping 規則
- [ ] 500+ 張黃金標準測試數據
- [ ] Azure 服務 POC 通過
- [ ] 開發環境就緒

---

#### MVP 0.5: 快速驗證

**目標：** 驗證核心 AI 提取和分類能力

**範圍確認：** ✅

| 功能 | 包含 | 說明 |
|------|------|------|
| **OCR 提取** | ✅ | Azure Document Intelligence |
| **AI 分類** | ✅ | 2 層映射架構（Universal + Forwarder-Specific） |
| **基本審核界面** | ✅ | 確認/修正功能 |
| **手動上傳** | ✅ | 單張/批量上傳 |
| **Excel 導出** | ✅ | 標準格式導出 |
| **基本監控** | ✅ | 處理狀態追蹤 |

**MVP 0.5 不包含：**
- ❌ SharePoint/Outlook 整合
- ❌ Azure AD SSO（使用簡單登入）
- ❌ 信心度顯示（後台計算但不展示）
- ❌ 多城市支援
- ❌ 完整報表功能
- ❌ 學習機制

**試用配置：**

| 項目 | 配置 |
|------|------|
| **試用人數** | 約 5 人（香港團隊） |
| **試用期間** | 2-4 週 |
| **測試數據** | 過去 1 年的歷史發票 |

**MVP 0.5 → MVP 1.0 決策標準：**

| 指標 | 目標 | 說明 |
|------|------|------|
| **提取成功率** | ≥ 90% | 文件能被成功處理 |
| **分類準確率** | ≥ 90% | 與黃金標準一致 |
| **用戶接受度** | 正面反饋 | 5 位試用者認可價值 |

```
MVP 0.5 決策點
     │
     ├── 達標（≥90% 成功率 + 準確率）
     │        ↓
     │   進入 MVP 1.0 開發
     │
     └── 未達標
              ↓
         分析原因，優化後重測
         • 規則不足 → 補充規則
         • AI 效果不佳 → 調整模型/Prompt
         • 特定 Forwarder 問題 → 針對性修復
```

---

#### MVP 1.0: 完整試行

**目標：** 香港團隊全面採用

| 功能 | 包含 | 說明 |
|------|------|------|
| **信心度顯示** | ✅ | 分層審核流程 |
| **SharePoint 整合** | ✅ | 自動獲取文件 |
| **Outlook 整合** | ✅ | 郵件附件處理 |
| **Azure AD SSO** | ✅ | 企業級登入 |
| **基本儀表板** | ✅ | 處理統計和 KPI |
| **Forwarder 管理** | ✅ | Profile 查看和編輯 |
| **審計日誌** | ✅ | 完整操作記錄 |
| **n8n 基本整合** | ✅ | 工作流觸發和監控 |

**MVP 1.0 試行配置：**

| 項目 | 配置 |
|------|------|
| **用戶數** | 香港全部相關人員（~10-15 人） |
| **試行期間** | 4-6 週 |
| **目標** | 100% 香港發票經過系統處理 |

**MVP 1.0 成功標準：**

| 指標 | 目標 |
|------|------|
| **自動化率** | ≥ 90% |
| **準確率** | ≥ 90% |
| **用戶採用率** | 100%（香港團隊） |
| **處理效率提升** | ≥ 70% |

---

#### MVP 1.5: 優化擴展

**目標：** 優化系統並準備多城市擴展

| 功能 | 包含 | 說明 |
|------|------|------|
| **學習機制** | ✅ | 第 3 層映射開始運作 |
| **多城市架構** | ✅ | 數據隔離 + RLS |
| **進階報表** | ✅ | 分析報表和趨勢 |
| **使用量追蹤** | ✅ | 成本分攤基礎 |
| **對外 API** | ✅ | 基本版本 |
| **效能優化** | ✅ | 批量處理能力提升 |

---

### Post-MVP Features（Phase 2+）

#### Phase 2: 區域擴展

| 功能 | 優先級 | 說明 |
|------|--------|------|
| **5 城市部署** | 高 | 新加坡、上海、深圳、廣州、台北 |
| **Top 30 Forwarder** | 高 | 擴展 Forwarder 覆蓋 |
| **自定義角色** | 中 | 靈活權限配置 |
| **成本分攤報表** | 中 | 城市級成本報告 |
| **多模態 AI 全面啟用** | 中 | 困難案例自動觸發 |

#### Phase 3: 全面覆蓋

| 功能 | 優先級 | 說明 |
|------|--------|------|
| **11 城市全部部署** | 高 | APAC 全覆蓋 |
| **全部 Forwarder** | 高 | 45+ Forwarder |
| **高級分析** | 中 | 供應商比較、異常檢測 |
| **Snowflake 整合** | 低 | 數據倉庫分析 |

#### 長期願景

| 功能 | 時間軸 | 說明 |
|------|--------|------|
| **全球擴展** | Year 2+ | APAC → 全球 |
| **98%+ 準確率** | Year 2+ | 極少人工介入 |
| **供應商績效評估** | Year 2+ | 議價建議 |
| **Forwarder 直接對接** | Year 3+ | EDI/API 整合 |

### Risk Mitigation Strategy

#### 技術風險

| 風險 | 影響 | 機率 | 緩解策略 |
|------|------|------|---------|
| **Azure DI 準確率不足** | 高 | 中 | Phase 0 POC 驗證；準備多模態備案 |
| **規則維護複雜** | 中 | 中 | 3 層架構降低規則數量 |
| **n8n 整合困難** | 低 | 低 | 已有自架服務器，團隊熟悉 |
| **效能瓶頸** | 中 | 低 | 雲端架構可橫向擴展 |

#### 市場/業務風險

| 風險 | 影響 | 機率 | 緩解策略 |
|------|------|------|---------|
| **用戶抵觸變更** | 高 | 中 | 早期參與、漸進推廣、培訓支援 |
| **業務流程變化** | 中 | 低 | 設計靈活的規則機制 |
| **Forwarder 格式變化** | 中 | 高 | 學習機制 + Super User 維護 |

#### 資源風險

| 風險 | 影響 | 機率 | 緩解策略 |
|------|------|------|---------|
| **人員離職** | 高 | 中 | 文檔完善、知識分享 |
| **開發進度延遲** | 中 | 中 | 分層 MVP、靈活調整範圍 |
| **預算超支** | 中 | 低 | AI API 成本監控、預算告警 |

#### 最小可行團隊

如果資源受限，最小可行配置：

| 角色 | 最小配置 | 說明 |
|------|---------|------|
| **全職開發** | 2 人 | 1 前端 + 1 後端/AI |
| **兼職支援** | 1 人 | n8n + 測試 |
| **業務配合** | 1 人 | Amy 或 Kevin |

### Scope Change Management

#### 範圍變更流程

```
範圍變更請求
     ↓
影響評估（時間、資源、風險）
     ↓
優先級判定
     ├── P0（必須）→ 納入當前階段
     ├── P1（重要）→ 下一階段
     └── P2（可選）→ Backlog
     ↓
決策記錄
```

#### 範圍凍結點

| 階段 | 凍結時間點 | 說明 |
|------|-----------|------|
| **MVP 0.5** | 開發開始後 1 週 | 核心功能凍結 |
| **MVP 1.0** | 開發開始後 2 週 | 功能清單凍結 |
| **MVP 1.5** | 按需調整 | 可根據 1.0 反饋調整 |

---

## Functional Requirements

### 1. 文件處理（Document Processing）

- **FR1**: 用戶可以手動上傳單張或批量發票文件（支援 PDF、圖片格式）
- **FR2**: 系統可以從 SharePoint 自動獲取待處理的發票文件
- **FR3**: 系統可以從 Outlook 郵件附件自動提取發票文件
- **FR4**: 系統可以使用 OCR 技術提取發票中的文字內容
- **FR5**: 系統可以識別發票所屬的 Forwarder
- **FR6**: 系統可以將提取的內容映射到標準化的 Header 欄位（約 90 個）
- **FR7**: 系統可以為每個提取結果計算信心度評分
- **FR8**: 系統可以根據信心度自動分流處理路徑（自動/快速確認/完整審核）

### 2. 審核與修正（Review & Correction）

- **FR9**: 數據處理員可以查看待審核的發票列表
- **FR10**: 數據處理員可以查看發票的提取結果和原始文件對照
- **FR11**: 數據處理員可以確認正確的提取結果
- **FR12**: 數據處理員可以修正錯誤的提取結果
- **FR13**: 數據處理員可以標記修正為「正常修正」或「特例不學習」
- **FR14**: 數據處理員可以將複雜案例升級給 Super User
- **FR15**: Super User 可以處理升級的複雜案例
- **FR16**: 系統可以顯示信心度低的原因和不確定的欄位

### 3. 規則管理（Rule Management）

- **FR17**: Super User 可以查看現有的映射規則
- **FR18**: Super User 可以建議新的映射規則
- **FR19**: Super User 可以審核待升級的學習規則
- **FR20**: 系統可以記錄用戶修正並識別重複模式
- **FR21**: 系統可以在累計 3 次相同修正後建議規則升級
- **FR22**: 系統可以在規則升級前顯示影響範圍分析
- **FR23**: 系統可以保留規則版本歷史（至少 5 個版本）
- **FR24**: 系統可以在準確率下降時自動回滾規則

### 4. Forwarder 管理（Forwarder Management）

- **FR25**: Super User 可以查看所有 Forwarder Profile 列表
- **FR26**: Super User 可以查看單個 Forwarder 的詳細配置
- **FR27**: Super User 可以編輯 Forwarder 特定的映射規則
- **FR28**: Super User 可以測試 Forwarder 規則變更的效果
- **FR29**: 系統管理員可以新增或停用 Forwarder Profile

### 5. 報表與分析（Reporting & Analytics）

- **FR30**: 用戶可以查看處理統計儀表板（處理量、成功率、自動化率）
- **FR31**: 用戶可以按時間範圍篩選報表數據
- **FR32**: 用戶可以按 Forwarder 篩選報表數據
- **FR33**: 城市經理可以匯出費用明細報表（Excel 格式）
- **FR34**: 區域經理可以查看跨城市的匯總報表
- **FR35**: 系統可以追蹤並顯示 AI API 使用量和成本

### 6. 用戶管理（User Management）

- **FR36**: 用戶可以使用 Azure AD SSO 登入系統
- **FR37**: 系統管理員可以查看所有用戶列表
- **FR38**: 系統管理員可以新增用戶並分配角色
- **FR39**: 系統管理員可以修改用戶的角色和城市歸屬
- **FR40**: 系統管理員可以停用用戶帳戶
- **FR41**: 系統管理員可以定義自定義角色
- **FR42**: 城市經理可以管理本城市的用戶

### 7. 多城市數據管理（Multi-City Data Management）

- **FR43**: 系統可以按城市隔離發票和處理數據
- **FR44**: 城市用戶僅能訪問本城市的數據
- **FR45**: 區域經理可以訪問授權城市的數據
- **FR46**: 全局管理者可以訪問所有城市的數據
- **FR47**: 系統可以在所有城市共享 Mapping Rules 和 Forwarder Profiles

### 8. 審計與追溯（Audit & Traceability）

- **FR48**: 系統可以記錄所有用戶操作日誌
- **FR49**: 系統可以記錄所有數據變更（修改人、時間、原因）
- **FR50**: 審計人員可以查詢指定期間的處理記錄
- **FR51**: 審計人員可以從任何數據點追溯至原始發票文件
- **FR52**: 審計人員可以匯出符合審計要求的報告
- **FR53**: 系統可以保留數據和日誌至少 7 年

### 9. 工作流整合（Workflow Integration）

- **FR54**: 系統可以與 n8n 工作流引擎進行雙向通訊
- **FR55**: n8n 管理員可以在系統內查看工作流執行狀態
- **FR56**: n8n 管理員可以手動觸發特定工作流
- **FR57**: n8n 管理員可以查看工作流執行錯誤詳情
- **FR58**: 系統可以追蹤文件在工作流中的處理進度

### 10. 系統管理（System Administration）

- **FR59**: 系統管理員可以查看系統健康狀態儀表板
- **FR60**: 系統管理員可以查看 Azure 服務的連接狀態
- **FR61**: 系統管理員可以查看系統日誌和錯誤記錄
- **FR62**: 系統管理員可以配置系統參數（如信心度閾值）
- **FR63**: 系統可以在異常情況下發送告警通知

### 11. 對外 API（External API）

- **FR64**: 外部系統可以通過 API 提交發票文件
- **FR65**: 外部系統可以通過 API 查詢處理狀態
- **FR66**: 外部系統可以通過 API 獲取提取結果
- **FR67**: 外部系統可以註冊 Webhook 接收處理完成通知
- **FR68**: API 可以支援基於角色的訪問控制

### 12. 成本追蹤（Cost Tracking）

- **FR69**: 系統可以按城市追蹤發票處理數量
- **FR70**: 系統可以按城市追蹤 AI API 調用成本
- **FR71**: 財務人員可以查看城市級別的成本報表
- **FR72**: 系統可以生成月度成本分攤報告

---

## Non-Functional Requirements

本章節定義系統的品質屬性要求，補充 Success Criteria 中的技術指標。所有 NFR 都應具體且可測量。

### Performance（效能）

#### API 響應時間

| 操作類型 | 目標響應時間 | 備註 |
|---------|-------------|------|
| **單張發票 AI 處理** | < 30 秒 | Azure DI + OpenAI 處理時間 |
| **Web 頁面載入** | < 2 秒 | 首次載入 |
| **搜尋結果返回** | < 1 秒 | 包含分頁 |
| **報表生成** | < 10 秒 | 標準報表 |
| **大型報表匯出** | < 60 秒 | > 10,000 條記錄 |
| **Dashboard 刷新** | < 3 秒 | 即時數據 |

#### 吞吐量

| 指標 | 目標值 | 測量條件 |
|------|--------|---------|
| **批量處理能力** | ≥ 500 張/小時 | 正常負載 |
| **峰值處理能力** | ≥ 1,000 張/小時 | 月結期間 |
| **並發 AI 請求** | ≥ 10 個 | 同時處理 |
| **並發用戶** | ≥ 50 個 | 無明顯延遲 |

#### 資源使用

| 指標 | 目標值 | 說明 |
|------|--------|------|
| **前端 Bundle 大小** | < 500 KB | gzip 後 |
| **記憶體使用** | < 2 GB | 每個服務實例 |
| **資料庫連線池** | ≤ 20 連線/城市 | 正常運行 |

### Security（安全性）

#### 身份認證與授權

| NFR-SEC | 需求 | 實現方式 |
|---------|------|---------|
| **NFR-SEC-01** | 所有用戶必須通過企業 SSO 認證 | Azure AD (Entra ID) |
| **NFR-SEC-02** | Session 過期時間 ≤ 8 小時 | 配合工作日長度 |
| **NFR-SEC-03** | 非活躍 Session 30 分鐘後自動登出 | 安全要求 |
| **NFR-SEC-04** | API 調用需有效 Token 認證 | JWT / OAuth 2.0 |
| **NFR-SEC-05** | 失敗登入嘗試 ≥ 5 次後鎖定 15 分鐘 | 防止暴力破解 |

#### 數據保護

| NFR-SEC | 需求 | 說明 |
|---------|------|------|
| **NFR-SEC-06** | 傳輸中數據加密 | TLS 1.2+ |
| **NFR-SEC-07** | 靜態數據加密 | Azure 預設加密 |
| **NFR-SEC-08** | 敏感欄位加密存儲 | 如有 PII 欄位 |
| **NFR-SEC-09** | 資料庫備份加密 | Azure 管理 |

#### 數據隔離

| NFR-SEC | 需求 | 實現方式 |
|---------|------|---------|
| **NFR-SEC-10** | 城市間數據嚴格隔離 | PostgreSQL RLS |
| **NFR-SEC-11** | 跨城市查詢需明確授權 | RBAC 檢查 |
| **NFR-SEC-12** | API 調用受城市權限限制 | 中間件驗證 |

#### 審計與日誌

| NFR-SEC | 需求 | 說明 |
|---------|------|------|
| **NFR-SEC-13** | 所有數據修改記錄審計日誌 | 誰、何時、改什麼 |
| **NFR-SEC-14** | 審計日誌不可刪除、不可篡改 | 獨立存儲 |
| **NFR-SEC-15** | 日誌保留 7 年 | 符合財務審計要求 |
| **NFR-SEC-16** | 敏感操作觸發即時告警 | 如批量刪除、權限變更 |

### Scalability（可擴展性）

#### 水平擴展

| NFR-SCA | 需求 | 說明 |
|---------|------|------|
| **NFR-SCA-01** | 無狀態服務設計 | 支援多實例部署 |
| **NFR-SCA-02** | 新城市上線 < 1 週 | 僅配置變更 |
| **NFR-SCA-03** | 新 Forwarder 支援 < 2 天 | 規則配置 |
| **NFR-SCA-04** | 峰值自動擴容 | Azure 自動縮放 |

#### 數據擴展

| NFR-SCA | 需求 | 說明 |
|---------|------|------|
| **NFR-SCA-05** | 支援 ≥ 500,000 張/年發票 | 當前需求 |
| **NFR-SCA-06** | 支援 3 倍數據增長 | 3 年預期 |
| **NFR-SCA-07** | 規則庫支援 ≥ 2,000 條 | 擴展空間 |
| **NFR-SCA-08** | 分頁查詢支援 ≥ 100 萬條記錄 | 不影響效能 |

#### 地理擴展

| NFR-SCA | 需求 | 說明 |
|---------|------|------|
| **NFR-SCA-09** | 支援 11 個 APAC 城市 | 短期目標 |
| **NFR-SCA-10** | 架構支援全球擴展 | 未來可能性 |
| **NFR-SCA-11** | 多語言支援架構 | 中文/英文優先 |

### Reliability（可靠性）

#### 可用性

| NFR-REL | 需求 | 說明 |
|---------|------|------|
| **NFR-REL-01** | 系統可用性 ≥ 99.5% | 月度計算，排除計劃維護 |
| **NFR-REL-02** | 單點故障 < 30 分鐘影響 | 快速切換 |
| **NFR-REL-03** | 計劃維護窗口 < 4 小時/月 | 非工作時段 |

#### 故障恢復

| NFR-REL | 需求 | 說明 |
|---------|------|------|
| **NFR-REL-04** | RPO（恢復點目標）< 1 小時 | 數據最多丟失 1 小時 |
| **NFR-REL-05** | RTO（恢復時間目標）< 4 小時 | 系統恢復上線時間 |
| **NFR-REL-06** | 數據庫自動備份 | 每日完整 + 每小時增量 |
| **NFR-REL-07** | 備份保留 ≥ 30 天 | 支援歷史恢復 |

#### 降級策略

| NFR-REL | 需求 | 說明 |
|---------|------|------|
| **NFR-REL-08** | AI 服務不可用時自動降級 | 排隊等待 + 用戶通知 |
| **NFR-REL-09** | 降級模式維持核心功能 | 手動處理入口可用 |
| **NFR-REL-10** | 服務恢復後自動處理積壓 | 批量重試機制 |

#### 錯誤處理

| NFR-REL | 需求 | 說明 |
|---------|------|------|
| **NFR-REL-11** | API 調用自動重試 ≤ 3 次 | 指數退避 |
| **NFR-REL-12** | 錯誤率 > 5% 觸發告警 | 即時通知 |
| **NFR-REL-13** | 所有錯誤記錄完整堆疊追蹤 | 便於排查 |

### Integration（整合性）

#### Azure 服務整合

| NFR-INT | 需求 | 說明 |
|---------|------|------|
| **NFR-INT-01** | Azure Document Intelligence API 整合 | OCR 核心 |
| **NFR-INT-02** | Azure OpenAI API 整合 | 多模態 AI |
| **NFR-INT-03** | Azure Blob Storage 整合 | 文件存儲 |
| **NFR-INT-04** | Azure AD SSO 整合 | 身份認證 |

#### Microsoft 生態整合

| NFR-INT | 需求 | 說明 |
|---------|------|------|
| **NFR-INT-05** | SharePoint 文件讀取 | 自動獲取發票 |
| **NFR-INT-06** | Outlook 附件提取 | 郵件發票處理 |
| **NFR-INT-07** | Excel 匯出 | 用戶熟悉格式 |

#### 工作流整合

| NFR-INT | 需求 | 說明 |
|---------|------|------|
| **NFR-INT-08** | n8n 工作流引擎整合 | 現有基礎設施 |
| **NFR-INT-09** | Webhook 觸發支援 | 外部系統通知 |
| **NFR-INT-10** | 工作流狀態可視化 | 監控處理進度 |

#### 對外 API

| NFR-INT | 需求 | 說明 |
|---------|------|------|
| **NFR-INT-11** | RESTful API 設計 | 標準 HTTP 方法 |
| **NFR-INT-12** | API 版本控制 | v1, v2... |
| **NFR-INT-13** | API 文檔（OpenAPI/Swagger） | 自動生成 |
| **NFR-INT-14** | API Rate Limiting | 防止濫用 |
| **NFR-INT-15** | API 調用追蹤 | 便於問題排查 |

### Accessibility（無障礙）

雖然是內部工具，仍需提供基本無障礙支援：

| NFR-ACC | 需求 | 說明 |
|---------|------|------|
| **NFR-ACC-01** | 符合 WCAG 2.1 Level A | 基本無障礙 |
| **NFR-ACC-02** | 支援鍵盤導航 | 可完全用鍵盤操作 |
| **NFR-ACC-03** | 足夠的顏色對比度 | ≥ 4.5:1 |
| **NFR-ACC-04** | 表單標籤明確 | 螢幕閱讀器支援 |
| **NFR-ACC-05** | 錯誤訊息清晰 | 指出具體問題和解決方式 |

### Maintainability（可維護性）

| NFR-MAI | 需求 | 說明 |
|---------|------|------|
| **NFR-MAI-01** | 程式碼覆蓋率 ≥ 70% | 核心功能 |
| **NFR-MAI-02** | 技術文檔完整 | 架構、API、部署 |
| **NFR-MAI-03** | 環境配置外部化 | 無硬編碼 |
| **NFR-MAI-04** | 日誌格式標準化 | 結構化 JSON |
| **NFR-MAI-05** | 監控儀表板 | 關鍵指標可視化 |
| **NFR-MAI-06** | 告警機制 | 異常即時通知 |

### Internationalization（國際化）

| NFR-I18N | 需求 | 說明 |
|---------|------|------|
| **NFR-I18N-01** | UI 支援繁體中文、簡體中文、英文 | 核心語言 |
| **NFR-I18N-02** | 語言切換即時生效 | 無需重載 |
| **NFR-I18N-03** | 日期/數字格式本地化 | 符合各城市習慣 |
| **NFR-I18N-04** | 時區支援 | 各城市本地時間 |

---

