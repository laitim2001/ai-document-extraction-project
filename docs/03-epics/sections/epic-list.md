# Epic List

## Epic 1: 用戶認證與存取控制

**用戶成果**：用戶可以安全登入系統，管理員可以管理用戶權限和角色分配

| 項目 | 內容 |
|------|------|
| **FRs** | FR36, FR37, FR38, FR39, FR40, FR41, FR42 |
| **NFRs** | NFR-SEC-01~05, ARCH-03 |
| **依賴** | 無（基礎 Epic） |
| **說明** | 這是系統基礎，所有其他功能都需要認證和授權 |

---

## Epic 2: 手動發票上傳與 AI 處理

**用戶成果**：用戶可以上傳發票文件，系統自動進行 OCR 提取、Forwarder 識別、欄位映射並計算信心度

| 項目 | 內容 |
|------|------|
| **FRs** | FR1, FR4, FR5, FR6, FR7, FR8 |
| **NFRs** | NFR-PERF-01~05, NFR-INT-01~02, ARCH-05~06 |
| **依賴** | Epic 1 |
| **說明** | 核心 AI 處理流程，支援 PDF 和圖片格式 |

---

## Epic 3: 發票審核與修正工作流

**用戶成果**：數據處理員可以審核 AI 提取結果，修正錯誤，並將複雜案例升級給 Super User

| 項目 | 內容 |
|------|------|
| **FRs** | FR9, FR10, FR11, FR12, FR13, FR14, FR15, FR16 |
| **NFRs** | UX-03, UX-04, UX-05, UX-06 |
| **依賴** | Epic 1, Epic 2 |
| **說明** | 並排 PDF 對照界面，信心度顏色編碼，支援修正標記 |

---

## Epic 4: 映射規則管理與自動學習

**用戶成果**：Super User 可以查看、建議、審核映射規則，系統可從修正中自動學習並建議規則升級

| 項目 | 內容 |
|------|------|
| **FRs** | FR17, FR18, FR19, FR20, FR21, FR22, FR23, FR24 |
| **NFRs** | - |
| **依賴** | Epic 1, Epic 3 |
| **說明** | 累計 3 次相同修正後建議升級，支援影響範圍分析和版本回滾 |

---

## Epic 5: Forwarder 配置管理

**用戶成果**：Super User 可以查看和編輯 Forwarder Profile，測試規則變更效果

| 項目 | 內容 |
|------|------|
| **FRs** | FR25, FR26, FR27, FR28, FR29 |
| **NFRs** | NFR-SCA-03 |
| **依賴** | Epic 1, Epic 2 |
| **說明** | 新 Forwarder 支援 <2 天，管理員可新增或停用 Profile |

---

## Epic 6: 多城市數據隔離

**用戶成果**：系統按城市隔離數據，用戶只能訪問授權城市的數據，同時共享全局規則

| 項目 | 內容 |
|------|------|
| **FRs** | FR43, FR44, FR45, FR46, FR47 |
| **NFRs** | NFR-SEC-10, NFR-SCA-09 |
| **依賴** | Epic 1 |
| **說明** | PostgreSQL RLS 實現數據隔離，支援 11 個 APAC 城市 |

---

## Epic 7: 報表儀表板與成本追蹤

**用戶成果**：用戶可以查看處理統計儀表板，城市/區域經理可以匯出報表，財務可以查看成本分攤

| 項目 | 內容 |
|------|------|
| **FRs** | FR30, FR31, FR32, FR33, FR34, FR35, FR69, FR70, FR71, FR72 |
| **NFRs** | - |
| **依賴** | Epic 1, Epic 2, Epic 3 |
| **說明** | 支援按時間和 Forwarder 篩選，追蹤 AI API 使用成本 |

---

## Epic 8: 審計追溯與合規

**用戶成果**：審計人員可以查詢處理記錄，追溯至原始文件，匯出合規報告

| 項目 | 內容 |
|------|------|
| **FRs** | FR48, FR49, FR50, FR51, FR52, FR53 |
| **NFRs** | NFR-SEC-13, NFR-SEC-14, NFR-SEC-15 |
| **依賴** | Epic 1, Epic 2, Epic 3 |
| **說明** | 不可刪除/篡改的審計日誌，保留 7 年 |

---

## Epic 9: 自動化文件獲取

**用戶成果**：系統可自動從 SharePoint 獲取待處理文件，從 Outlook 郵件提取附件

| 項目 | 內容 |
|------|------|
| **FRs** | FR2, FR3 |
| **NFRs** | NFR-INT-05, NFR-INT-06 |
| **依賴** | Epic 1, Epic 2 |
| **說明** | 擴展 Epic 2 的文件來源，實現自動化處理流程 |

---

## Epic 10: n8n 工作流整合

**用戶成果**：系統與 n8n 整合，管理員可查看工作流狀態、手動觸發、追蹤處理進度

| 項目 | 內容 |
|------|------|
| **FRs** | FR54, FR55, FR56, FR57, FR58 |
| **NFRs** | NFR-INT-08 |
| **依賴** | Epic 1, Epic 2 |
| **說明** | 平台提供 API 供 n8n 調用，n8n 負責流程編排 |

**分工說明**：
- **平台職責**：提供處理 API、狀態查詢 API、Webhook 配置、n8n 連接監控
- **n8n 職責**：觸發源監控、流程編排、下游整合（用戶在 n8n 自行配置）

---

## Epic 11: 對外 API 服務

**用戶成果**：外部系統可通過 API 提交發票、查詢狀態、獲取結果，支援 Webhook 通知

| 項目 | 內容 |
|------|------|
| **FRs** | FR64, FR65, FR66, FR67, FR68 |
| **NFRs** | NFR-INT-11, NFR-SEC-04, ARCH-08 |
| **依賴** | Epic 1, Epic 2 |
| **說明** | RESTful API，JWT/OAuth 2.0 認證，RFC 7807 錯誤格式 |

---

## Epic 12: 系統管理與監控

**用戶成果**：系統管理員可以監控系統健康、查看連接狀態、配置參數、接收異常告警

| 項目 | 內容 |
|------|------|
| **FRs** | FR59, FR60, FR61, FR62, FR63 |
| **NFRs** | NFR-REL-01~08, NFR-MAI-05 |
| **依賴** | Epic 1 |
| **說明** | 健康狀態儀表板，Azure 服務監控，告警通知 |

---

## Epic 13: 文件預覽與欄位映射

**用戶成果**：審核人員可以在預覽 PDF 時看到欄位高亮，管理員可以配置靈活的欄位映射規則

| 項目 | 內容 |
|------|------|
| **FRs** | FR9, FR10（審核相關），擴展 Epic 2 處理流程 |
| **NFRs** | PDF 載入 <2 秒，高亮渲染 <100ms，映射執行 <50ms |
| **依賴** | Epic 0（DocumentFormat 模型）, Epic 2, Epic 3 |
| **說明** | react-pdf 預覽，bounding box 高亮，動態映射配置（Format > Company > Global） |

---

## Epic 14: Prompt 配置與動態生成

**用戶成果**：管理員可以為不同 Company 和 DocumentFormat 配置專屬的 GPT Prompt，實現更精準的識別

| 項目 | 內容 |
|------|------|
| **FRs** | 擴展 FR5, FR6（AI 處理相關） |
| **NFRs** | 術語分類準確率 ≥92%，API 響應 <200ms |
| **依賴** | Epic 0（Story 0-8 發行者識別、Story 0-9 格式分類） |
| **說明** | 三層 Prompt 配置（Global → Company → Format），支援變數替換和合併策略 |

---

## Epic 15: 統一 3 層機制到日常處理流程

**用戶成果**：日常上傳的發票可以享受與歷史數據初始化相同的智能識別和分類功能

| 項目 | 內容 |
|------|------|
| **FRs** | 統一 FR1~FR8（文件處理），擴展 Epic 2 流程 |
| **NFRs** | 自動通過率 ≥85%，處理延遲增加 <500ms，新術語學習覆蓋率 ≥95% |
| **依賴** | Epic 0, Epic 13, Epic 14 |
| **說明** | UnifiedDocumentProcessor 統一入口，11 步處理管道，信心度路由（AUTO_APPROVE/QUICK_REVIEW/FULL_REVIEW） |

---
