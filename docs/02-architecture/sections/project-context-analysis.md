# 專案上下文分析

## 需求概覽

**功能需求：**

| 類別 | 需求描述 | 架構影響 |
|------|----------|----------|
| AI 驅動提取 | 使用 Azure Document Intelligence + OpenAI 多模態模型提取 Freight Invoice 內容 | 需要設計 AI 服務層 |
| 智能映射系統 | 三層映射架構（Forwarder Profile → Universal Mapping → Learning Layer） | 規則引擎設計 |
| 信心度分流 | 信心度機制（>90% 自動、70-90% 快速確認、<70% 完整審核） | 路由邏輯設計 |
| 持續學習 | 3 次確認升級為正式規則的學習閉環 | 反饋機制設計 |
| 多格式支援 | 支援 100+ 種發票格式（45+ Forwarder） | Forwarder Profile 管理 |
| 審核界面 | PDF 對照審核界面（並排顯示） | 前端組件設計 |
| 企業整合 | SharePoint、Outlook、n8n 工作流整合 | API 整合設計 |

**非功能需求：**

| 項目 | 目標值 | 說明 |
|------|--------|------|
| 系統可用性 | 99.5% uptime | 月度計算，計劃維護除外 |
| 並發用戶 | 50 人同時使用 | 系統不出現明顯延遲 |
| AI 響應時間 | < 30 秒/張 | Azure DI + OpenAI 處理時間 |
| 批量處理能力 | ≥ 500 張/小時 | 正常負載 |
| 峰值處理能力 | ≥ 1000 張/小時 | 月結期間 |
| 數據保留期限 | 7 年 | 符合財務審計要求 |
| 恢復點目標 (RPO) | < 1 小時 | 數據最多丟失 1 小時 |
| 恢復時間目標 (RTO) | < 4 小時 | 系統恢復上線時間 |
| 審計日誌 | 不可刪除、不可篡改 | 獨立存儲 |

**規模與複雜度：**

| 指標 | 評估 | 說明 |
|------|------|------|
| 主要領域 | 全端 + AI 服務 | 前後端 + AI 服務 + 工作流 |
| 複雜度等級 | 高 | AI 整合 + 多系統對接 + 學習機制 |
| 預估架構組件 | 8-10 個主要服務 | 詳見後續架構設計 |
| 年處理量 | 450,000-500,000 張 | APAC 地區發票 |
| 區域擴展 | 11 個 APAC 城市 | 香港先行，逐步推廣 |

## 技術約束與依賴

| 約束項目 | 說明 | 影響範圍 |
|----------|------|----------|
| n8n 服務器 | 已部署，必須整合 | 工作流編排設計 |
| Azure 生態系統 | 必須使用 Azure AD、Document Intelligence、OpenAI | 雲端架構決策 |
| PostgreSQL | 主要數據庫 | 數據模型設計 |
| Microsoft 整合 | SharePoint + Outlook | API 整合模式 |
| 技術棧已定義 | Next.js + React + shadcn/ui + Python | 前後端技術選型 |

## 橫切關注點

| 關注點 | 說明 | 影響範圍 |
|--------|------|----------|
| 認證授權 | Azure AD SSO | 所有模組 |
| 審計日誌 | 7 年保留，不可篡改 | 所有數據操作 |
| 異步處理 | 基於隊列的 AI 提取 | 可靠性保障 |
| 監控告警 | 系統健康監控 | 所有服務 |
| 錯誤處理 | Azure 服務不可用時的降級策略 | 關鍵服務 |
| 多租戶 | 區域數據隔離 | APAC 擴展規劃 |

## 技術風險備註

| 風險項目 | 影響 | 需要架構決策 |
|----------|------|--------------|
| 多模態 AI API 成本 | 50 萬張/年的 API 費用估算 | 成本優化策略 |
| 第三層學習機制 | 實現複雜度較高 | 具體技術方案設計 |
| Azure 服務降級 | 服務不可用時的業務連續性 | 降級策略設計 |

---
