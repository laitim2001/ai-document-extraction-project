# Story 16.1: æ ¼å¼åˆ—è¡¨ Tab

**Status:** done

---

## Story

**As a** ç³»çµ±ç®¡ç†å“¡,
**I want** åœ¨å…¬å¸è©³æƒ…é çœ‹åˆ°è©²å…¬å¸æ‰€æœ‰å·²è­˜åˆ¥çš„æ–‡ä»¶æ ¼å¼åˆ—è¡¨,
**So that** æˆ‘å¯ä»¥äº†è§£å’Œç®¡ç†è©²å…¬å¸çš„æ–‡ä»¶æ ¼å¼ã€‚

---

## èƒŒæ™¯èªªæ˜

### å•é¡Œé™³è¿°

ç›®å‰ç³»çµ±æœƒè‡ªå‹•è­˜åˆ¥å’Œè¨˜éŒ„æ–‡ä»¶æ ¼å¼ï¼ˆDocumentFormatï¼‰ï¼Œä½†ç”¨æˆ¶ç„¡æ³•ï¼š
- æŸ¥çœ‹å…¬å¸æœ‰å“ªäº›å·²è­˜åˆ¥çš„æ ¼å¼
- äº†è§£æ¯ç¨®æ ¼å¼çš„æ–‡ä»¶æ•¸é‡
- æŸ¥çœ‹æ ¼å¼æ˜¯å¦å·²é…ç½®å°ˆå±¬çš„ Prompt å’Œæ˜ å°„è¦å‰‡

### è§£æ±ºæ–¹æ¡ˆ

åœ¨å…¬å¸è©³æƒ…é ï¼ˆ`/companies/[id]`ï¼‰æ–°å¢ã€Œæ ¼å¼ã€Tabï¼Œé¡¯ç¤ºè©²å…¬å¸æ‰€æœ‰å·²è­˜åˆ¥çš„æ–‡ä»¶æ ¼å¼åˆ—è¡¨ã€‚

---

## Acceptance Criteria

### AC1: æ ¼å¼ Tab å…¥å£

**Given** ç”¨æˆ¶åœ¨å…¬å¸è©³æƒ…é 
**When** æŸ¥çœ‹ Tab åˆ—è¡¨
**Then**:
  - é¡¯ç¤ºã€Œæ ¼å¼ã€Tabï¼ˆä½æ–¼ã€Œè¦å‰‡ã€Tab ä¹‹å¾Œï¼‰
  - Tab é¡¯ç¤ºæ ¼å¼æ•¸é‡ badge

### AC2: æ ¼å¼åˆ—è¡¨é¡¯ç¤º

**Given** å…¬å¸æœ‰å·²è­˜åˆ¥çš„æ ¼å¼
**When** é»æ“Šã€Œæ ¼å¼ã€Tab
**Then**:
  - é¡¯ç¤ºæ ¼å¼å¡ç‰‡åˆ—è¡¨
  - æ¯å¼µå¡ç‰‡é¡¯ç¤ºï¼šæ ¼å¼åç¨±ã€é¡å‹ã€å­é¡å‹
  - æ¯å¼µå¡ç‰‡é¡¯ç¤ºï¼šæ–‡ä»¶æ•¸é‡
  - æ¯å¼µå¡ç‰‡é¡¯ç¤ºï¼šé…ç½®ç‹€æ…‹ï¼ˆPrompt âœ…/âŒã€æ˜ å°„ âœ…/âŒï¼‰

### AC3: ç©ºç‹€æ…‹è™•ç†

**Given** å…¬å¸æ²’æœ‰å·²è­˜åˆ¥çš„æ ¼å¼
**When** é»æ“Šã€Œæ ¼å¼ã€Tab
**Then**:
  - é¡¯ç¤ºç©ºç‹€æ…‹æç¤º
  - æç¤ºæ–‡å­—ï¼šã€Œå°šç„¡å·²è­˜åˆ¥çš„æ ¼å¼ã€‚ä¸Šå‚³æ–‡ä»¶å¾Œç³»çµ±æœƒè‡ªå‹•è­˜åˆ¥æ ¼å¼ã€‚ã€

### AC4: ç¯©é¸åŠŸèƒ½

**Given** æ ¼å¼åˆ—è¡¨
**When** ä½¿ç”¨ç¯©é¸æ§ä»¶
**Then**:
  - å¯æŒ‰æ–‡ä»¶é¡å‹ï¼ˆdocumentTypeï¼‰ç¯©é¸
  - å¯æŒ‰å­é¡å‹ï¼ˆdocumentSubtypeï¼‰ç¯©é¸

### AC5: æ’åºåŠŸèƒ½

**Given** æ ¼å¼åˆ—è¡¨
**When** ä½¿ç”¨æ’åºæ§ä»¶
**Then**:
  - å¯æŒ‰æ–‡ä»¶æ•¸é‡æ’åºï¼ˆé è¨­ï¼šé™åºï¼‰
  - å¯æŒ‰æ›´æ–°æ™‚é–“æ’åº

### AC6: æ ¼å¼å¡ç‰‡æ“ä½œ

**Given** æ ¼å¼å¡ç‰‡
**When** èˆ‡å¡ç‰‡äº’å‹•
**Then**:
  - é»æ“Šå¡ç‰‡ï¼šé€²å…¥æ ¼å¼è©³æƒ…é 
  - æ›´å¤šé¸å–®ï¼šç·¨è¼¯ã€åˆªé™¤é¸é …

---

## Tasks / Subtasks

- [x] **Task 1: ä¿®æ”¹å…¬å¸è©³æƒ…é ** (AC: #1)
  - [x] 1.1 åœ¨ `ForwarderDetailView.tsx` æ–°å¢ã€Œæ ¼å¼ã€Tab
  - [x] 1.2 å¯¦ç¾æ ¼å¼æ•¸é‡ badgeï¼ˆç”± FormatList çµ„ä»¶å…§éƒ¨é¡¯ç¤ºï¼‰

- [x] **Task 2: å»ºç«‹æ ¼å¼åˆ—è¡¨çµ„ä»¶** (AC: #2, #3)
  - [x] 2.1 å»ºç«‹ `src/components/features/formats/FormatList.tsx`
  - [x] 2.2 å¯¦ç¾åˆ—è¡¨ä½ˆå±€ï¼ˆgrid 3 æ¬„ï¼‰
  - [x] 2.3 å¯¦ç¾ç©ºç‹€æ…‹ UI

- [x] **Task 3: å»ºç«‹æ ¼å¼å¡ç‰‡çµ„ä»¶** (AC: #2, #6)
  - [x] 3.1 å»ºç«‹ `src/components/features/formats/FormatCard.tsx`
  - [x] 3.2 é¡¯ç¤ºæ ¼å¼åŸºæœ¬ä¿¡æ¯ï¼ˆé¡å‹ã€å­é¡å‹ã€æ–‡ä»¶æ•¸ã€è¡“èªæ•¸ï¼‰
  - [x] 3.3 é¡¯ç¤ºé…ç½®ç‹€æ…‹æ¨™è¨˜ï¼ˆhasPromptConfig, hasMappingConfigï¼‰
  - [x] 3.4 å¯¦ç¾é»æ“Šè·³è½‰å’Œæ›´å¤šé¸å–®

- [x] **Task 4: å¯¦ç¾ç¯©é¸å’Œæ’åº** (AC: #4, #5)
  - [x] 4.1 å»ºç«‹ `FormatFilters.tsx` çµ„ä»¶
  - [x] 4.2 å¯¦ç¾é¡å‹ç¯©é¸ï¼ˆdocumentType, documentSubtypeï¼‰
  - [x] 4.3 å¯¦ç¾æ’åºåŠŸèƒ½ï¼ˆfileCount, updatedAtï¼‰

- [x] **Task 5: æ•¸æ“šç²å–** (AC: #2)
  - [x] 5.1 å»ºç«‹ `useCompanyFormats` Hook
  - [x] 5.2 é€£æ¥ç¾æœ‰ API `/api/v1/formats?companyId={id}`
  - [x] 5.3 è™•ç†åŠ è¼‰å’ŒéŒ¯èª¤ç‹€æ…‹

- [x] **Task 6: é©—è­‰èˆ‡æ¸¬è©¦** (AC: #1-6)
  - [x] 6.1 TypeScript é¡å‹æª¢æŸ¥é€šé
  - [x] 6.2 ESLint æª¢æŸ¥é€šé
  - [x] 6.3 åŠŸèƒ½é©—è­‰æ¸¬è©¦

---

## Dev Notes

### ä¾è³´é …

- **ç¾æœ‰æ¨¡å‹**: DocumentFormatï¼ˆPrisma Schema å·²å­˜åœ¨ï¼‰
- **ç¾æœ‰ API**: `GET /api/v1/formats`ï¼ˆå·²å­˜åœ¨ï¼Œæ”¯æ´ companyId ç¯©é¸ï¼‰
- **ç¾æœ‰ Hook**: `useDocumentFormatOptions`ï¼ˆå¯åƒè€ƒï¼‰

### çµ„ä»¶çµæ§‹

```
src/components/features/formats/
â”œâ”€â”€ FormatList.tsx           # æ ¼å¼åˆ—è¡¨
â”œâ”€â”€ FormatCard.tsx           # æ ¼å¼å¡ç‰‡
â”œâ”€â”€ FormatFilters.tsx        # ç¯©é¸æ§ä»¶
â””â”€â”€ index.ts                 # å°å‡º
```

### API éŸ¿æ‡‰æ ¼å¼

```typescript
// GET /api/v1/formats?companyId={id}
{
  success: true,
  data: {
    formats: [
      {
        id: string,
        companyId: string,
        companyName: string,
        documentType: DocumentType,
        documentSubtype: DocumentSubtype,
        name: string | null,
        fileCount: number,
        commonTerms: string[],
        createdAt: ISO8601,
        updatedAt: ISO8601
      }
    ],
    pagination: {
      page: number,
      limit: number,
      total: number,
      totalPages: number
    }
  }
}
```

### UI åƒè€ƒ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ ¼å¼åˆ—è¡¨                                     [+ æ–°å¢æ ¼å¼]   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ é¡å‹: [å…¨éƒ¨ â–¼]  å­é¡å‹: [å…¨éƒ¨ â–¼]  æ’åº: [æ–‡ä»¶æ•¸ â–¼]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ“„ DHL æµ·é‹ç™¼ç¥¨                                   [â‹®]  â”‚ â”‚
â”‚ â”‚ é¡å‹: INVOICE / OCEAN_FREIGHT                          â”‚ â”‚
â”‚ â”‚ æ–‡ä»¶æ•¸: 156    è¡“èª: 45 å€‹                             â”‚ â”‚
â”‚ â”‚ Prompt: âœ…   æ˜ å°„: âœ…                                  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementation Notes

### å®Œæˆæ—¥æœŸ
2026-01-12

### å¯¦ç¾å…§å®¹

#### 1. é¡å‹æ“´å±• (`src/types/document-format.ts`)
- æ–°å¢ `DocumentFormatListItem` ä»‹é¢ï¼ˆå« hasPromptConfig, hasMappingConfigï¼‰
- æ–°å¢ `FormatFiltersState` ä»‹é¢ï¼ˆç¯©é¸ç‹€æ…‹ï¼‰
- æ–°å¢ `DOCUMENT_TYPE_OPTIONS` å’Œ `DOCUMENT_SUBTYPE_OPTIONS` å¸¸æ•¸

#### 2. Hook å¯¦ç¾ (`src/hooks/use-company-formats.ts`)
- ä½¿ç”¨ React Query ç²å–å…¬å¸æ ¼å¼åˆ—è¡¨
- æ”¯æ´ç¯©é¸ï¼ˆdocumentType, documentSubtypeï¼‰å’Œæ’åºï¼ˆfileCount, updatedAtï¼‰
- 5 åˆ†é˜ staleTime å¿«å–ç­–ç•¥

#### 3. çµ„ä»¶å¯¦ç¾ (`src/components/features/formats/`)
- **FormatCard**: æ ¼å¼å¡ç‰‡ï¼Œé¡¯ç¤ºé¡å‹æ¨™ç±¤ã€çµ±è¨ˆæ•¸æ“šã€é…ç½®ç‹€æ…‹
- **FormatFilters**: ç¯©é¸æ§ä»¶ï¼Œæ”¯æ´é¡å‹/å­é¡å‹ç¯©é¸å’Œæ’åºåˆ‡æ›
- **FormatList**: ä¸»åˆ—è¡¨çµ„ä»¶ï¼Œæ•´åˆç¯©é¸ã€ç©ºç‹€æ…‹ã€éŒ¯èª¤è™•ç†
- **index.ts**: çµ±ä¸€å°å‡º

#### 4. ForwarderDetailView ä¿®æ”¹
- TabsList å¾ 4 æ¬„æ”¹ç‚º 5 æ¬„ï¼ˆæ–°å¢ã€Œæ ¼å¼ã€Tabï¼‰
- æ–°å¢ `<FormatList companyId={forwarderId} />` TabsContent

### æ–‡ä»¶è®Šæ›´
| æ–‡ä»¶ | è®Šæ›´é¡å‹ |
|------|----------|
| `src/types/document-format.ts` | ä¿®æ”¹ - æ–°å¢é¡å‹å’Œå¸¸æ•¸ |
| `src/hooks/use-company-formats.ts` | æ–°å¢ |
| `src/components/features/formats/FormatCard.tsx` | æ–°å¢ |
| `src/components/features/formats/FormatFilters.tsx` | æ–°å¢ |
| `src/components/features/formats/FormatList.tsx` | æ–°å¢ |
| `src/components/features/formats/index.ts` | æ–°å¢ |
| `src/components/features/forwarders/ForwarderDetailView.tsx` | ä¿®æ”¹ - æ–°å¢ Tab |

### å¾ŒçºŒå·¥ä½œ
- Story 16-2: æ ¼å¼è©³æƒ…é é¢ï¼ˆé»æ“Šå¡ç‰‡è·³è½‰ç›®æ¨™ï¼‰
- Story 16-3: è­˜åˆ¥è¦å‰‡é…ç½®
- Story 16-4: å°ˆå±¬é…ç½®é—œè¯

---

## Related Files

- `src/components/features/forwarders/ForwarderDetailView.tsx` - éœ€ä¿®æ”¹
- `src/hooks/use-document-formats.ts` - åƒè€ƒ
- `src/app/api/v1/formats/route.ts` - ç¾æœ‰ API
