# generated: 2025-12-15
# project: ai-document-extraction-project
# tracking_system: file-system
# story_location: docs/04-implementation/stories

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic not yet started
#   - in-progress: Epic actively being worked on
#   - done: All stories in epic completed
#
# Epic Status Transitions:
#   - backlog → in-progress: Automatically when first story is created (via create-story)
#   - in-progress → done: Manually when all stories reach 'done' status
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - drafted: Story file created in stories folder
#   - ready-for-dev: Draft approved and story context created
#   - in-progress: Developer actively working on implementation
#   - review: Ready for code review (via Dev's code-review workflow)
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - completed: Retrospective has been done
#
# WORKFLOW NOTES:
# ===============
# - Epic transitions to 'in-progress' automatically when first story is created
# - Stories can be worked in parallel if team capacity allows
# - SM typically drafts next story after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', then runs code-review (fresh context, different LLM recommended)

generated: 2025-12-15
project: ai-document-extraction-project
tracking_system: file-system
story_location: docs/04-implementation/stories

development_status:
  # ============================================================
  # Epic 1: 用戶認證與存取控制
  # ============================================================
  epic-1: done  # All stories completed 2025-12-18
  1-0-project-init-foundation: done
  1-1-azure-ad-sso-login: done
  1-2-user-database-role-foundation: done  # Completed 2025-12-18: DB migration + seed executed
  1-3-user-list-search: done  # Completed 2025-12-18: User list page with search, filter, pagination
  1-4-add-user-role-assignment: done  # Completed 2025-12-18: Add User dialog with role assignment
  1-5-modify-user-role-city: done  # Completed 2025-12-18: Edit user dialog, update API, audit logging
  1-6-disable-enable-user-account: done  # Completed 2025-12-18: User status toggle, API endpoint, audit logging
  1-7-custom-role-management: done  # Completed 2025-12-18: Role CRUD, permission selector UI, system role protection
  1-8-city-manager-user-management: done  # Completed 2025-12-18: City permission middleware, city service, API filtering
  epic-1-retrospective: optional

  # ============================================================
  # Epic 2: 手動發票上傳與 AI 處理
  # ============================================================
  epic-2: done  # All stories completed 2025-12-18
  2-1-file-upload-interface-validation: done  # Completed 2025-12-18: Upload UI with drag-drop, validation, preview
  2-2-file-ocr-extraction-service: done  # Completed 2025-12-18: Python OCR service, Azure DI integration, Next.js API
  2-3-forwarder-auto-identification: done  # Completed 2025-12-18: Forwarder model, pattern matching service, confidence scoring
  2-4-field-mapping-extraction: done  # Completed 2025-12-18: MappingRule/ExtractionResult models, field definitions, Python mapper, API routes, seed data
  2-5-confidence-score-calculation: done  # Completed 2025-12-18: Multi-factor weighted scoring, confidence types, calculator, historical accuracy service, UI components, API endpoints
  2-6-processing-path-auto-routing: done  # Completed 2025-12-18: ProcessingQueue model, routing types/config, router logic, routing service, API endpoints
  2-7-processing-status-tracking-display: done  # Completed 2025-12-18: Document list page, status badges, retry button, dynamic polling
  epic-2-retrospective: optional

  # ============================================================
  # Epic 3: 發票審核與修正工作流
  # ============================================================
  epic-3: done  # All stories completed 2025-12-18
  3-1-pending-review-invoice-list: done  # Completed 2025-12-18: Review queue API, hooks, UI components, page
  3-2-side-by-side-pdf-review-interface: done  # Completed 2025-12-18: PDF viewer, review panel, resizable layout, field-source linking
  3-3-confidence-color-coding-display: done  # Completed 2025-12-18: Color coding, tooltip, low confidence filter
  3-4-confirm-extraction-result: done  # Completed 2025-12-18: Approve API, ReviewRecord model, audit logging, ApprovalConfirmDialog, QuickReviewMode
  3-5-correct-extraction-result: done  # Completed 2025-12-18: FieldEditor, correct API, useSaveCorrections hook, UnsavedChangesGuard, field validation
  3-6-correction-type-marking: done  # Completed 2025-12-18: CorrectionType enum, RuleSuggestion model, correctionAnalyzer, notification service, CorrectionTypeDialog
  3-7-escalate-complex-cases: done  # Completed 2025-12-18: Escalation model, EscalationDialog, escalate API, useEscalateReview hook, Super User notification
  3-8-super-user-handle-escalated-cases: done  # Completed 2025-12-18: Escalation list/detail APIs, hooks, UI components, resolve workflow
  epic-3-retrospective: optional

  # ============================================================
  # Epic 4: 映射規則管理與自動學習
  # ============================================================
  epic-4: done  # All stories completed 2025-12-19
  4-1-mapping-rule-list-view: done  # Completed 2025-12-18: Rule list page, filters, detail view, API endpoints, React Query hooks
  4-2-suggest-new-mapping-rule: done  # Completed 2025-12-18: New rule form, pattern editors, test panel, API endpoints, React Query hooks
  4-3-correction-pattern-recording-analysis: done  # Completed 2025-12-19: Correction model, CorrectionPattern, PatternAnalysisLog, similarity algorithms, pattern analysis service, cron job API
  4-4-rule-upgrade-suggestion-generation: done  # Completed 2025-12-19: RuleSuggestion types, rule inference engine, suggestion generator service, API routes, React Query hooks
  4-5-rule-impact-scope-analysis: done  # Completed 2025-12-19: Impact types, ImpactAnalysisService, RuleSimulationService, API routes, React Query hooks, UI components
  4-6-review-learning-rule: done  # Completed 2025-12-19: Review types, approve/reject APIs, useRuleApprove/useRuleReject hooks, ReviewDetailPage, ApproveDialog, RejectDialog, ImpactSummaryCard, SampleCasesTable, review pages
  4-7-rule-version-history-management: done  # Completed 2025-12-19: Version types, versions/compare/rollback APIs, useVersions hooks, VersionDiffViewer, RollbackConfirmDialog, VersionCompareDialog, history page
  4-8-rule-auto-rollback: done  # Completed 2025-12-19: Accuracy types, RollbackLog/Notification models, RuleAccuracyService, AutoRollbackService, accuracy/rollback-logs APIs, useAccuracy/useRollback hooks, AccuracyMetrics component, rollback-history page
  epic-4-retrospective: optional

  # ============================================================
  # Epic 5: Forwarder 配置管理
  # ============================================================
  epic-5: done  # All stories completed 2025-12-19
  5-1-forwarder-profile-list: done  # Completed 2025-12-19: Forwarder list page with search, filter, sort, pagination
  5-2-forwarder-detail-config-view: done  # Completed 2025-12-19: Detail page with tabs, stats panel, rules table, recent documents
  5-3-edit-forwarder-mapping-rules: done  # Completed 2025-12-19: RuleChangeRequest flow, RuleEditForm, pattern editors, preview panel, ForwarderRulesTable integration
  5-4-test-rule-change-effect: done  # Completed 2025-12-19: RuleTestTask/Detail models, rule-testing.service, test APIs, PDF/Excel reports, React Query hooks, test page UI
  5-5-add-disable-forwarder-profile: done  # Completed 2025-12-19: ForwarderForm, LogoUploader, Azure Blob service, create/update/deactivate/activate APIs, ForwarderActions dialogs
  epic-5-retrospective: optional

  # ============================================================
  # Epic 6: 多城市數據隔離
  # ============================================================
  epic-6: done  # All stories completed 2025-12-19
  6-1-city-data-model-rls-config: done  # Completed 2025-12-19: Region/City/UserCityAccess models, RLS policies, city-access.service, NextAuth integration, seed data
  6-2-city-user-data-access-control: done  # Completed 2025-12-19: API city filter middleware, resource access validator, security log service, useUserCity hook, CityIndicator/CityRestricted components
  6-3-regional-manager-cross-city-access: done  # Completed 2025-12-19: UserRegionAccess model, RegionalManagerService, accessible cities API, city filter hook/components, city comparison API/component, multi-city export API/dialog
  6-4-global-admin-full-access: done  # Completed 2025-12-19: SystemConfig/ConfigHistory models, GlobalAdminService, SystemConfigService, global analytics API, config management API, GlobalDashboard page, RegionView, CityRankings, GlobalTrend, SystemConfigPage
  6-5-global-rule-sharing-mechanism: done  # Completed 2025-12-19: RuleCacheVersion model, RuleResolver service, ForwarderIdentifier service, RuleMetricsService, version/metrics APIs, useRuleVersion hook, cache invalidation integration
  epic-6-retrospective: optional

  # ============================================================
  # Epic 7: 報表儀表板與成本追蹤
  # ============================================================
  epic-7: in-progress  # Started 2025-12-19
  7-1-processing-statistics-dashboard: done  # Completed 2025-12-19: Dashboard types, DashboardStatisticsService with caching, StatCard component, DashboardStats container, React Query integration
  7-2-time-range-filter: ready-for-dev
  7-3-forwarder-filter: ready-for-dev
  7-4-expense-detail-report-export: ready-for-dev
  7-5-cross-city-summary-report: ready-for-dev
  7-6-ai-api-usage-cost-display: ready-for-dev
  7-7-city-processing-volume-tracking: ready-for-dev
  7-8-city-ai-cost-tracking: ready-for-dev
  7-9-city-cost-report: ready-for-dev
  7-10-monthly-cost-allocation-report: ready-for-dev
  epic-7-retrospective: optional

  # ============================================================
  # Epic 8: 審計追溯與合規
  # ============================================================
  epic-8: backlog
  8-1-user-operation-log-recording: ready-for-dev
  8-2-data-change-tracking: ready-for-dev
  8-3-processing-record-query: ready-for-dev
  8-4-original-file-traceability: ready-for-dev
  8-5-audit-report-export: ready-for-dev
  8-6-long-term-data-retention: ready-for-dev
  epic-8-retrospective: optional

  # ============================================================
  # Epic 9: 自動化文件獲取
  # ============================================================
  epic-9: in-progress
  9-1-sharepoint-file-monitoring-api: ready-for-dev
  9-2-sharepoint-connection-config: ready-for-dev
  9-3-outlook-mail-attachment-extraction-api: ready-for-dev
  9-4-outlook-connection-config: ready-for-dev
  9-5-auto-retrieval-source-tracking: ready-for-dev
  epic-9-retrospective: optional

  # ============================================================
  # Epic 10: n8n 工作流整合
  # ============================================================
  epic-10: in-progress
  10-1-n8n-bidirectional-communication-api: ready-for-dev
  10-2-webhook-config-management: ready-for-dev
  10-3-workflow-execution-status-view: ready-for-dev
  10-4-manual-trigger-workflow: ready-for-dev
  10-5-workflow-error-detail-view: ready-for-dev
  10-6-document-processing-progress-tracking: ready-for-dev
  10-7-n8n-connection-status-monitoring: ready-for-dev
  epic-10-retrospective: optional

  # ============================================================
  # Epic 11: 對外 API 服務
  # ============================================================
  epic-11: in-progress
  11-1-api-invoice-submission-endpoint: ready-for-dev
  11-2-api-processing-status-query-endpoint: ready-for-dev
  11-3-api-processing-result-retrieval-endpoint: ready-for-dev
  11-4-webhook-notification-service: ready-for-dev
  11-5-api-access-control-authentication: ready-for-dev
  11-6-api-documentation-developer-support: ready-for-dev
  epic-11-retrospective: optional

  # ============================================================
  # Epic 12: 系統管理與監控
  # ============================================================
  epic-12: in-progress
  12-1-system-health-monitoring-dashboard: ready-for-dev
  12-2-performance-metrics-tracking: ready-for-dev
  12-3-error-alert-configuration: ready-for-dev
  12-4-system-configuration-management: ready-for-dev
  12-5-data-backup-management: ready-for-dev
  12-6-data-recovery-functionality: ready-for-dev
  12-7-system-log-query: ready-for-dev
  epic-12-retrospective: optional
