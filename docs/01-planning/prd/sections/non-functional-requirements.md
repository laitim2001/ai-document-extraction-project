# Non-Functional Requirements

本章節定義系統的品質屬性要求，補充 Success Criteria 中的技術指標。所有 NFR 都應具體且可測量。

## Performance（效能）

### API 響應時間

| 操作類型 | 目標響應時間 | 備註 |
|---------|-------------|------|
| **單張發票 AI 處理** | < 30 秒 | Azure DI + OpenAI 處理時間 |
| **Web 頁面載入** | < 2 秒 | 首次載入 |
| **搜尋結果返回** | < 1 秒 | 包含分頁 |
| **報表生成** | < 10 秒 | 標準報表 |
| **大型報表匯出** | < 60 秒 | > 10,000 條記錄 |
| **Dashboard 刷新** | < 3 秒 | 即時數據 |

### 吞吐量

| 指標 | 目標值 | 測量條件 |
|------|--------|---------|
| **批量處理能力** | ≥ 500 張/小時 | 正常負載 |
| **峰值處理能力** | ≥ 1,000 張/小時 | 月結期間 |
| **並發 AI 請求** | ≥ 10 個 | 同時處理 |
| **並發用戶** | ≥ 50 個 | 無明顯延遲 |

### 資源使用

| 指標 | 目標值 | 說明 |
|------|--------|------|
| **前端 Bundle 大小** | < 500 KB | gzip 後 |
| **記憶體使用** | < 2 GB | 每個服務實例 |
| **資料庫連線池** | ≤ 20 連線/城市 | 正常運行 |

## Security（安全性）

### 身份認證與授權

| NFR-SEC | 需求 | 實現方式 |
|---------|------|---------|
| **NFR-SEC-01** | 所有用戶必須通過企業 SSO 認證 | Azure AD (Entra ID) |
| **NFR-SEC-02** | Session 過期時間 ≤ 8 小時 | 配合工作日長度 |
| **NFR-SEC-03** | 非活躍 Session 30 分鐘後自動登出 | 安全要求 |
| **NFR-SEC-04** | API 調用需有效 Token 認證 | JWT / OAuth 2.0 |
| **NFR-SEC-05** | 失敗登入嘗試 ≥ 5 次後鎖定 15 分鐘 | 防止暴力破解 |

### 數據保護

| NFR-SEC | 需求 | 說明 |
|---------|------|------|
| **NFR-SEC-06** | 傳輸中數據加密 | TLS 1.2+ |
| **NFR-SEC-07** | 靜態數據加密 | Azure 預設加密 |
| **NFR-SEC-08** | 敏感欄位加密存儲 | 如有 PII 欄位 |
| **NFR-SEC-09** | 資料庫備份加密 | Azure 管理 |

### 數據隔離

| NFR-SEC | 需求 | 實現方式 |
|---------|------|---------|
| **NFR-SEC-10** | 城市間數據嚴格隔離 | PostgreSQL RLS |
| **NFR-SEC-11** | 跨城市查詢需明確授權 | RBAC 檢查 |
| **NFR-SEC-12** | API 調用受城市權限限制 | 中間件驗證 |

### 審計與日誌

| NFR-SEC | 需求 | 說明 |
|---------|------|------|
| **NFR-SEC-13** | 所有數據修改記錄審計日誌 | 誰、何時、改什麼 |
| **NFR-SEC-14** | 審計日誌不可刪除、不可篡改 | 獨立存儲 |
| **NFR-SEC-15** | 日誌保留 7 年 | 符合財務審計要求 |
| **NFR-SEC-16** | 敏感操作觸發即時告警 | 如批量刪除、權限變更 |

## Scalability（可擴展性）

### 水平擴展

| NFR-SCA | 需求 | 說明 |
|---------|------|------|
| **NFR-SCA-01** | 無狀態服務設計 | 支援多實例部署 |
| **NFR-SCA-02** | 新城市上線 < 1 週 | 僅配置變更 |
| **NFR-SCA-03** | 新 Forwarder 支援 < 2 天 | 規則配置 |
| **NFR-SCA-04** | 峰值自動擴容 | Azure 自動縮放 |

### 數據擴展

| NFR-SCA | 需求 | 說明 |
|---------|------|------|
| **NFR-SCA-05** | 支援 ≥ 500,000 張/年發票 | 當前需求 |
| **NFR-SCA-06** | 支援 3 倍數據增長 | 3 年預期 |
| **NFR-SCA-07** | 規則庫支援 ≥ 2,000 條 | 擴展空間 |
| **NFR-SCA-08** | 分頁查詢支援 ≥ 100 萬條記錄 | 不影響效能 |

### 地理擴展

| NFR-SCA | 需求 | 說明 |
|---------|------|------|
| **NFR-SCA-09** | 支援 11 個 APAC 城市 | 短期目標 |
| **NFR-SCA-10** | 架構支援全球擴展 | 未來可能性 |
| **NFR-SCA-11** | 多語言支援架構 | 中文/英文優先 |

## Reliability（可靠性）

### 可用性

| NFR-REL | 需求 | 說明 |
|---------|------|------|
| **NFR-REL-01** | 系統可用性 ≥ 99.5% | 月度計算，排除計劃維護 |
| **NFR-REL-02** | 單點故障 < 30 分鐘影響 | 快速切換 |
| **NFR-REL-03** | 計劃維護窗口 < 4 小時/月 | 非工作時段 |

### 故障恢復

| NFR-REL | 需求 | 說明 |
|---------|------|------|
| **NFR-REL-04** | RPO（恢復點目標）< 1 小時 | 數據最多丟失 1 小時 |
| **NFR-REL-05** | RTO（恢復時間目標）< 4 小時 | 系統恢復上線時間 |
| **NFR-REL-06** | 數據庫自動備份 | 每日完整 + 每小時增量 |
| **NFR-REL-07** | 備份保留 ≥ 30 天 | 支援歷史恢復 |

### 降級策略

| NFR-REL | 需求 | 說明 |
|---------|------|------|
| **NFR-REL-08** | AI 服務不可用時自動降級 | 排隊等待 + 用戶通知 |
| **NFR-REL-09** | 降級模式維持核心功能 | 手動處理入口可用 |
| **NFR-REL-10** | 服務恢復後自動處理積壓 | 批量重試機制 |

### 錯誤處理

| NFR-REL | 需求 | 說明 |
|---------|------|------|
| **NFR-REL-11** | API 調用自動重試 ≤ 3 次 | 指數退避 |
| **NFR-REL-12** | 錯誤率 > 5% 觸發告警 | 即時通知 |
| **NFR-REL-13** | 所有錯誤記錄完整堆疊追蹤 | 便於排查 |

## Integration（整合性）

### Azure 服務整合

| NFR-INT | 需求 | 說明 |
|---------|------|------|
| **NFR-INT-01** | Azure Document Intelligence API 整合 | OCR 核心 |
| **NFR-INT-02** | Azure OpenAI API 整合 | 多模態 AI |
| **NFR-INT-03** | Azure Blob Storage 整合 | 文件存儲 |
| **NFR-INT-04** | Azure AD SSO 整合 | 身份認證 |

### Microsoft 生態整合

| NFR-INT | 需求 | 說明 |
|---------|------|------|
| **NFR-INT-05** | SharePoint 文件讀取 | 自動獲取發票 |
| **NFR-INT-06** | Outlook 附件提取 | 郵件發票處理 |
| **NFR-INT-07** | Excel 匯出 | 用戶熟悉格式 |

### 工作流整合

| NFR-INT | 需求 | 說明 |
|---------|------|------|
| **NFR-INT-08** | n8n 工作流引擎整合 | 現有基礎設施 |
| **NFR-INT-09** | Webhook 觸發支援 | 外部系統通知 |
| **NFR-INT-10** | 工作流狀態可視化 | 監控處理進度 |

### 對外 API

| NFR-INT | 需求 | 說明 |
|---------|------|------|
| **NFR-INT-11** | RESTful API 設計 | 標準 HTTP 方法 |
| **NFR-INT-12** | API 版本控制 | v1, v2... |
| **NFR-INT-13** | API 文檔（OpenAPI/Swagger） | 自動生成 |
| **NFR-INT-14** | API Rate Limiting | 防止濫用 |
| **NFR-INT-15** | API 調用追蹤 | 便於問題排查 |

## Accessibility（無障礙）

雖然是內部工具，仍需提供基本無障礙支援：

| NFR-ACC | 需求 | 說明 |
|---------|------|------|
| **NFR-ACC-01** | 符合 WCAG 2.1 Level A | 基本無障礙 |
| **NFR-ACC-02** | 支援鍵盤導航 | 可完全用鍵盤操作 |
| **NFR-ACC-03** | 足夠的顏色對比度 | ≥ 4.5:1 |
| **NFR-ACC-04** | 表單標籤明確 | 螢幕閱讀器支援 |
| **NFR-ACC-05** | 錯誤訊息清晰 | 指出具體問題和解決方式 |

## Maintainability（可維護性）

| NFR-MAI | 需求 | 說明 |
|---------|------|------|
| **NFR-MAI-01** | 程式碼覆蓋率 ≥ 70% | 核心功能 |
| **NFR-MAI-02** | 技術文檔完整 | 架構、API、部署 |
| **NFR-MAI-03** | 環境配置外部化 | 無硬編碼 |
| **NFR-MAI-04** | 日誌格式標準化 | 結構化 JSON |
| **NFR-MAI-05** | 監控儀表板 | 關鍵指標可視化 |
| **NFR-MAI-06** | 告警機制 | 異常即時通知 |

## Internationalization（國際化）

| NFR-I18N | 需求 | 說明 |
|---------|------|------|
| **NFR-I18N-01** | UI 支援繁體中文、簡體中文、英文 | 核心語言 |
| **NFR-I18N-02** | 語言切換即時生效 | 無需重載 |
| **NFR-I18N-03** | 日期/數字格式本地化 | 符合各城市習慣 |
| **NFR-I18N-04** | 時區支援 | 各城市本地時間 |

---

