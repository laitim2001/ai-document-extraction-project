# 索引維護指引

> 本文件說明如何維護 PROJECT-INDEX.md 保持與項目結構同步。

---

## 概述

PROJECT-INDEX.md 是項目的快速導航索引，需要在項目結構發生變化時及時更新，以確保 AI 助手和開發團隊能夠快速找到所需文件。

---

## 維護責任

### AI 助手職責
1. 在每次 Session 開始時檢查索引是否有明顯過時
2. 在建立新文件或目錄後主動更新索引
3. 在 Session 結束時確認索引狀態
4. 執行 `npm run index:check` 驗證同步狀態

### 觸發更新的情況
| 變更類型 | 是否需要更新 | 說明 |
|----------|-------------|------|
| 新增 Epic/Story | ✅ 是 | 更新 Epic 索引區塊 |
| 新增 Service 文件 | ✅ 是 | 更新服務索引區塊 |
| 新增 API 路由 | ✅ 是 | 更新 API 路由區塊 |
| 新增文檔目錄 | ✅ 是 | 更新對應章節 |
| 修改現有文件內容 | ❌ 否 | 內容變更不影響索引 |
| 重命名文件 | ✅ 是 | 更新對應連結 |
| 刪除文件 | ✅ 是 | 移除對應連結 |
| Story 狀態變更 | ✅ 是 | 更新狀態圖標 |

---

## 更新流程

### 手動更新步驟

1. **確認變更範圍**
   ```bash
   git status
   ```

2. **識別需要更新的索引區塊**
   - 新 Story → Epic 索引區塊
   - 新 Service → 服務區塊
   - 新 API → API 路由區塊
   - 新文檔 → 對應文檔區塊

3. **編輯 PROJECT-INDEX.md**
   - 在對應區塊新增條目
   - 使用正確的相對路徑
   - 添加適當的說明

4. **驗證連結有效性**
   ```bash
   npm run index:check
   ```

5. **更新同步日期**
   - 修改文件頂部的「最後同步日期」

### 自動檢查

使用驗證腳本檢查索引同步狀態：

```bash
npm run index:check
```

腳本會檢查：
- ✅ 索引中的文件是否存在
- ✅ 重要文件是否已納入索引
- ⚠️ 可能缺失的新文件

---

## 索引區塊結構

### Epic 索引區塊格式
```markdown
### Epic X: [Epic 名稱] [狀態圖標]
| Story | 文件 | 狀態 |
|-------|------|------|
| X-1 | [X-1-story-name.md](./path/to/file.md) | ✅ |
| X-2 | [X-2-story-name.md](./path/to/file.md) | 🟡 |

**Tech Specs**: [docs/04-implementation/tech-specs/epic-XX/](./path/to/tech-specs/)
```

### 服務索引區塊格式
```markdown
#### [服務分類名稱]
| 服務 | 說明 |
|------|------|
| [service-name.ts](./src/services/service-name.ts) | 服務說明 |
```

### API 路由區塊格式
```markdown
#### API 路由
| 路徑 | 說明 |
|------|------|
| `src/app/api/path/` | 路由說明 |
```

---

## 狀態圖標說明

| 圖標 | 說明 | 使用情況 |
|------|------|----------|
| ✅ | 已完成 | Story/Epic 已完成開發 |
| 🟡 | 進行中 | 正在開發中 |
| ⚪ | 待開始 | 尚未開始開發 |
| ⏸️ | 暫停 | 因故暫停 |

---

## 常見維護場景

### 場景 1：完成一個 Story
```markdown
1. 找到對應 Epic 區塊
2. 將該 Story 的狀態從 🟡 改為 ✅
3. 如果所有 Story 完成，更新 Epic 標題狀態
4. 更新最後同步日期
```

### 場景 2：新增 Service 文件
```markdown
1. 確認 Service 所屬分類（核心處理/用戶權限/審計監控等）
2. 在對應分類區塊新增條目
3. 使用一致的格式和說明風格
4. 更新最後同步日期
```

### 場景 3：新增 Epic Story 文件
```markdown
1. 在 docs/04-implementation/stories/ 建立文件
2. 在 PROJECT-INDEX.md 對應 Epic 區塊新增條目
3. 設定初始狀態為 ⚪
4. 更新最後同步日期
```

### 場景 4：重構目錄結構
```markdown
1. 先執行 git mv 重命名/移動文件
2. 批量更新 PROJECT-INDEX.md 中的所有相關路徑
3. 執行 npm run index:check 驗證
4. 確認所有連結正確
5. 更新最後同步日期
```

---

## 驗證腳本使用說明

### 執行檢查
```bash
npm run index:check
```

### 輸出說明
```
✅ 找到文件: ./CLAUDE.md
✅ 找到文件: ./docs/01-planning/prd/prd.md
❌ 缺失文件: ./docs/missing-file.md
⚠️ 可能需要索引: ./src/services/new-service.ts
```

### 處理方式
- ❌ **缺失文件**: 確認文件是否已刪除，若是則從索引移除
- ⚠️ **可能需要索引**: 確認是否為重要文件，若是則新增到索引

---

## 索引維護檢查清單

### Session 開始時
- [ ] 執行 `npm run index:check` 檢查同步狀態
- [ ] 查看是否有新的 Story 或服務需要加入

### 開發過程中
- [ ] 新增文件時立即更新索引
- [ ] 刪除文件時同時移除索引條目
- [ ] 重命名時更新對應連結

### Session 結束時
- [ ] 確認所有新增文件已加入索引
- [ ] 更新 Story/Epic 狀態
- [ ] 執行 `npm run index:check` 最終驗證
- [ ] 更新最後同步日期

---

## 索引品質標準

### 連結有效性
- 所有連結指向實際存在的文件
- 使用相對路徑（./ 開頭）
- 路徑區分大小寫

### 說明完整性
- 每個條目都有簡短說明
- 說明使用一致的風格和格式
- 避免過長或過於簡短的說明

### 組織邏輯性
- 按功能分類組織
- 相關文件放在一起
- 使用清晰的區塊標題

---

*指引版本：1.1.0*
*建立日期：2025-12-21*
*最後更新：2025-12-26*
